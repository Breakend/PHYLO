
/*
Developed By: Alfred Kam (www.cs.mcgill.ca/~akam2/), McGill MCB
Testing By: Daniel Kwak (www.cs.mcgill.ca/~dkwak/), McGill MCB 
Supervisors: Jerome Waldispuhl and Mathieu Blanchette, McGill University
Type: Desktop / Mobile Browser Edition
Supported Platforms: Android, iPod, iPhone, iPad, Chrome, Safari, FireFox
About: A McGill Phylo Project

Copyright Alfred Kam and McGill MCB

Version: 3.0.0.0
Last Updated Nov 2011
*/
var DEBUG=false;var option=false;var optionScale=0;var production=true;(function(){(function(){function a(){}a.prototype.find=function(a){if(document.getElementById(a)!=undefined)console.log("found > "+a)};var b=a.prototype,c=[["find",b.find]];common.exportSingleton("test",a,c)})();(function(){function a(){}var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";a.prototype.generate=function(){if(!window.production)return true;var a="";for(var c=0;c<6;c++){a+=b.charAt(Math.floor(Math.random()*b.length))}this.code=a;if(window.location.hash.search("home")>-1)window.location.hash="#home/PLAY/"+a;if(common.checkDevice()!="other"&&common.checkDevice()!="ipad")window.location.hash="#PLAY/"+a};a.prototype.get=function(){if(!window.production)return true;return this.code};a.prototype.check=function(){var a=window.location.hash;if(!window.production)return true;if(this.code==undefined)return false;if(a.search(this.code)>-1&&a.search("PLAY")>-1)return true;else return false};var c=a.prototype,d=[["generate",c.generate],["get",c.get],["check",c.check]];common.exportSingleton("gameID",a,d)})();(function(){function b(){this.generateRandomAncestor()}b.prototype.setSettings=function(a,b,c,d){this.gs=a;this.gData=b;this.Grid=c;this.setStageMap();this.par=this.scorePar();fitch.setPar(this.par);this.randomMap();this.preSetGameSettings();animate.compactNodeLost=true;if(mcb.GET("dev")!="true")this.dumpMusic();mcb.setgs(a);this.controller(0,d);if(common.checkDevice()=="other"^common.checkDevice()=="ipad")tutorial.fn.inGameTutorial()};b.prototype.dumpMusic=function(){var a="";var b=this.gs;var a="<audio autoplay='autoplay' loop='loop' id='game-audio' preload='auto' autobuffer style='display:none'><source src='http://www.cs.mcgill.ca/~jeromew/pub/Valent/Valent%20-%20The%20Buckle.mp3' />Your browser does not support audio element</audio><div id='audioPlayer'><a href='#' class='player' id='playaudio' style='display:none'><div><img src='../img/speaker_on.png' class='audioUnMute'/></div></a><a href='#' class='player' id='pause'><div><img src='../img/speaker_off.png' class='audioMute'/></div></a></div>";$("#sandbox").append(a);if(common.checkDevice()=="other"){$("#footer").css({top:(b.y+1.2)*b.yPx+b.yPx*b.yMargin})}else{if(common.checkDevice()=="ipad")$("#footer").show()}$("#audioPlayer").css({position:"absolute",top:(b.y+1)*b.yPx+b.yPx*b.yMargin,left:(b.x-5.5)*b.xPx,width:"5em",height:"5em",zIndex:100});if(common.checkDevice()=="ipad"){$("#audioPlayer").css({left:(b.x-6)*b.xPx})}if(1024>window.innerWidth){$("#audioPlayer").css({left:(b.x-8.5)*b.xPx})}$(".audioMute").css({height:"50px"});$(".audioUnMute").css({height:"50px"});$("#pause div").css({position:"relative",width:"50px",height:"50px"});$("#playaudio div").css({position:"relative",width:"50px",height:"50px"});$("#pause").click(function(){document.getElementById("game-audio").volume=0;$(this).hide();$("#playaudio").show()});$("#playaudio").click(function(){document.getElementById("game-audio").volume=1;$(this).hide();$("#pause").show()})};b.prototype.intify=function(a){if(a=="x")return a;else return parseInt(a)};b.prototype.randomMap=function(){var b=this.Grid.slice(0);var c=this.gs;for(var d=0;d<8;d++){tmp=b[d].toString().split("x,").join("").split(",");while((a=tmp.length)<b[d].length)tmp.splice(Math.floor(Math.random()*a),0,"x");tmp=tmp.map(this.intify);b[d]=tmp.slice(0)}for(var d=0;d<b.length;d++)for(var e=0;e<b[d].length;e++)if(b[d][e]!="x")$("#"+b[d][e]).css("left",c.xPx*c.xMargin+e*c.xPx+2);gameIDE.updateGrid(b);this.Grid=b.slice(0);for(var d=0,f=this.tree,g=f.length;d<g;d++){this.setStage(d);fitch.algo(b,c,this.gData,f,d)}for(var d=0,f=this.tree,g=f.length;d<g;d++){f[d].bestScore=f[d].score}};b.prototype.scorePar=function(){var a=this.tree.slice(0);var b=this.Grid;var c=this.gs;var d=this.gData;var e=[];if(window.DEBUG){console.log(b);console.log(d)}for(var f=0;f<a.length;f++){this.setStage(f);var g=fitch.algo(b,c,d,a,f);if(window.DEBUG)console.log("@par stage "+f+" > "+g[f].score);e.push(g[f].score)}return e};b.prototype.preSetGameSettings=function(){$(".row").each(function(){$(this).addClass("new")})};b.prototype.setStageMap=function(){if(common.checkDevice()=="other"^common.checkDevice()=="ipad"){this.tree=animate.getGameTree()}else{this.tree=animate.getGameTree()}};b.prototype.showStageSeq=function(a){if($("#row"+a).hasClass("blackout")){$("#row"+a).removeClass("blackout");$("#row"+a).children().each(function(){if($(this).hasClass("blackoutseq"))$(this).removeClass("blackoutseq")})}if($("#row"+a).hasClass("new"))$("#row"+a).removeClass("new");$("#row"+a).addClass("current")};b.prototype.setStage=function(a){var b=this.tree[a];if(b.child==0){this.showStageSeq(b.node1);this.showStageSeq(b.node2)}else if(b.child==1){this.showStageSeq(b.node1);this.setStage(b.node2)}else if(b.child==2){this.setStage(b.node1);this.setStage(b.node2)}};b.prototype.controller=function(a,b){$("#grids").touchstart(function(a){a.preventDefault()});if(common.checkDevice()=="other")$("#footer").show();mcb.run("gameStart");var c=this;var d=window.option;if(gameID.check()==false){return}var e={start:function(a){if(a<c.tree.length){animate.stageAnimation(a+1);mcb.setStage(a);c.setStage(a);gameIDE.gameEngine(c.gs,c.gData,c.tree,a);if(a==0&&mcb.cookie.read("phylo-tutorial-"+window.guest)!="complete"){if(common.checkDevice()=="ipad"^common.checkDevice()=="other")window.setTimeout(function(){animate.tutorial()},1e3)}if(d)animate.buildCompactTree()}},reset:function(a){if(a<c.tree.length-1){$(".row").each(function(){if($(this).hasClass("current")){$(this).removeClass("current");$(this).addClass("blackout");$(this).children().each(function(){if($(this).hasClass("sequence"))$(this).addClass("blackoutseq")})}})}else{animate.endGameMenu(0)}}};animate.timer();e.start(a);if(common.checkDevice()=="other"^common.checkDevice()=="ipad"){window.setTimeout(function(){animate.multiSelect(b,c.Grid,c.tree,c.gData)},0)}if(common.checkDevice()=="other")$("#game-star").click(function(){if($("#game-star").hasClass("game-proceed")){e.reset(a);e.start(++a)}else{fitch.reset()}});else $("#game-star").touchstart(function(){if($("#game-star").hasClass("game-proceed")){e.reset(a);e.start(++a)}else{fitch.reset()}})};b.prototype.request=function(){};b.prototype.generateRandomAncestor=function(){this.ancestorList=this.getRandomSequence(6)};b.prototype.getRandomSequence=function(a){var b=new Array;for(var c=0;c<a;c++){b.push(this.generateSeq(Math.floor(Math.random()*10)+10,5))}return b};b.prototype.generateSeq=function(a,b){var c=["A","G","U","T","_"];var d="";for(var e=0;e<a;e++){d+=c[Math.floor(Math.random()*b)]}return d};var c=b.prototype,d=[["init",new b],["request",c.request],["getRandomAncestor",c.getRandomAncestor],["getRandomSequence",c.getRandomSequence],["gamePlan",c.gamePlan],["getAncestor",c.getAncestor],["generateSeq",c.generateSeq]];common.exportSingleton("comm",b,d)})();(function(){function b(){}var a=false;b.prototype.endGameScore=function(){return{stage:this.stage,stageLength:this.tree.length,score:this.tree[this.stage].score,par:this.par[this.stage]}};b.prototype.debug=function(a){if(document.getElementById("debug")==undefined){$("#sandbox").append("debug");$("#debug").css("top","0");$("#debug").css("left","0")}else{$("#debug").html(a)}};b.prototype.forward=function(a,b){var c=this.tree[a];var d=this.grid;if(c.child==2){var e=this.forward(c.node2,b);var f=this.forward(c.node1,b);var g=[];for(var h=0;h<e.length;h++)for(var i=0;i<f.length;i++){if(e[h]==f[h]&&e[h]!="x")g.push(e[h])}if(g.length<1)return e.concat(f);else return g}else if(c.child==1){var e=this.forward(c.node2,b);var f=this.trans(d[c.node1][b]);if(e.indexOf(f)>-1){return[f]}else{if(f=="x"){return e}else{return e.concat([f])}}}else{var e=this.trans(d[c.node1][b]);var f=this.trans(d[c.node2][b]);if(e!="x"&&f==e)return[e];else if(e!="x"&&f!="x"&&f!=e)return[e,f];else if(e=="x"&&f==e)return[];else if(e=="x"&&f!="x")return[f];else if(f=="x"&&e!="x")return[e]}};b.prototype.backward=function(a){var b=this.grid[0].length;var c=[];for(var d=0;d<b;d++){var e=this.forward(a,d);if(e.length<1)c.push("x");else{c.push(e[0])}}return c};b.prototype.trace=function(a,b,c){var d=this.backward(c);var e=function(){this.match=0;this.mismatch=0;this.open=0;this.extend=0};var f=new e;var g=new e;var h={match:1,mismatch:-1,open:-5,extend:-1};f=this.traceScore(d,a,f);g=this.traceScore(d,b,g);var i=f.match*h.match+f.mismatch*h.mismatch+f.open*h.open+f.extend*h.extend+g.match*h.match+g.mismatch*h.mismatch+g.open*h.open+g.extend*h.extend;if(window.DEBUG){console.log("@trace - score > "+i);console.log("@trace - ancester > "+d);console.log(d)}return{ancester:d,score:i}};b.prototype.trans=function(a){if(a!="x")return this.translate($("#"+a).css("background-color"));else return"x"};b.prototype.traceScore=function(a,b,c){for(var d=0;d<a.length;d++){if(a[d]=="x"){continue}else if(this.trans(b[d])=="x"){if(d!=0&&b[d-1]=="x"&&a[d-1]!="x"){c.extend++}else{c.open++}}else if(this.trans(b[d])==a[d]||b[d]==a[d]){c.match++}else{c.mismatch++}}if(window.DEBUG)console.log(c.match+"Match "+c.mismatch+"Mismatch "+c.open+"Open "+c.extend+"Extend ");return c};b.prototype.score=function(a){var b=this.tree[a];var c=0;var d=0;if(window.DEBUG){console.log("@score - depth - game lv > "+a)}if(b.child==0){var e=this.trace(this.grid[b.node1],this.grid[b.node2],a)}else if(b.child==1){var e=this.trace(this.grid[b.node1],this.score(b.node2),a);c=this.tree[b.node2].score}else{var e=this.trace(this.score(b.node1),this.score(b.node2),a);d=this.tree[b.node1].score+this.tree[b.node2].score}e.score+=c+d;if(b.score==undefined){b.bestAncester=e.ancester;b.ancester=e.ancester;b.score=e.score;b.seq1=this.grid[b.node1];b.seq2=this.grid[b.node2]}else if(e.score>b.score){b.bestAncester=e.ancester;b.ancester=e.ancester;b.score=e.score;b.seq1=this.grid[b.node1];b.seq2=this.grid[b.node2]}else{b.ancester=e.ancester;b.score=e.score}if(this.par!=undefined){if(b.score>=0)$("#ctn-score-"+a).html("+"+b.score);else $("#ctn-score-"+a).html("<span style='color:red'>"+b.score+"</span>")}return e.ancester};b.prototype.setPar=function(a){this.par=a};b.prototype.algo=function(a,b,c,d,e){this.grid=a;this.gs=b;this.gData=c;this.tree=d;this.stage=e;var f=this.score(e);if(this.tree[e].bestScore==undefined)this.tree[e].bestScore=-1e3;if(window.DEBUG)console.log("@algo > "+this.tree[e].score);if(this.tree[e].score>=this.tree[e].bestScore){this.tree[e].bestScore=this.tree[e].score;this.bestGrid=[];for(var g=0;g<a.length;g++){this.bestGrid.push(a[g].slice(0))}}if(this.par!=undefined){$("#score").html("Score: "+this.tree[e].score+"<br><label class='par'>Par: "+this.par[e]+"</label><br><label class='par'>Stage: "+(e+1)+"/"+d.length+"</label><br><label class='par'>Best Score: "+d[e].bestScore+"</label>");if(d[e].score>=this.par[e]){$(".game-cycle").hide();$(".game-star").show();$("#game-star").addClass("game-proceed");$("#game-star").css("opacity","1");var h=this;for(var g=0;g<3;g++){window.setTimeout(function(){h.starAnimation()},1e3*g)}}else{$(".game-cycle").show();$(".game-star").hide();$("#game-star").removeClass("game-proceed");$("#game-star").css("opacity","0.5")}}seq.buildRootAncester(b.xPx,b.yPx,b,f);animate.updateTree(this.tree,e);return this.tree};b.prototype.starAnimation=function(){var a=this.gs;window.setTimeout(function(){if($("#game-star").hasClass("game-proceed")==false)return;$("#game-star").animate({top:-1*a.xPx},200,function(){$(this).animate({top:""},200,function(){$(this).animate({top:-1*a.xPx/2},180,function(){$(this).animate({top:""},150)})})})},0)};b.prototype.reset=function(){var a=this.stage;var b=this.gs;for(var c=0;c<this.bestGrid.length;c++)for(var d=0;d<this.bestGrid[c].length;d++)if(this.bestGrid[c][d]!="x")$("#"+this.bestGrid[c][d]).css("left",b.xPx*b.xMargin+d*b.xPx+2);this.grid=this.bestGrid.slice(0);gameIDE.updateGrid(this.grid);this.tree=fitch.algo(this.grid,this.gs,this.gData,this.tree,this.stage);if(this.par!=undefined){console.log("dasd");$("#score").html("Score: "+this.tree[a].bestScore+"<br><label class='par'>Par: "+this.par[a]+"</label><br><label class='par'>Stage: "+(a+1)+"/"+tree.length+"</label><label class='par'>Best Score: "+tree[a].bestScore+"</label>");if(this.tree[a].bestScore>=this.par[a]){$(".game-cycle").hide();$(".game-star").show();$("#game-star").addClass("game-proceed");$("#game-star").css("opacity","1");for(var c=0;c<3;c++){window.setTimeout(function(){f.starAnimation()},1e3*c)}}else{$(".game-cycle").show();$(".game-star").hide();$("#game-star").removeClass("game-proceed");$("#game-star").css("opacity","0.5")}}};b.prototype.resetPosition=function(a){var b=this.tree[a];if(b.child==0){this.format(b.seq1,b.node1);this.format(b.seq2,b.node2)}else if(b.child==1){this.resetPosition(b.node1);this.format(b.seq2,b.node2)}else{this.resetPosition(b.node1);this.resetPosition(b.node2)}};b.prototype.format=function(a,b){console.log(b);var c=this.gs;for(var d=0;d<a.length;d++){if(a[d]!="x")$("#"+a[d]).css("left",c.xPx*c.xMargin+d*c.xPx)}};b.prototype.translate=function(a){if(a=="#71B2E2")return"A";if(a=="#9932CC")return"G";if(a=="#008000")return"C";if(a=="#FFA500")return"T";if(a=="rgb(153, 50, 204)")return"G";if(a=="rgb(0, 128, 0)")return"C";if(a=="rgb(113, 178, 226)")return"A";if(a=="rgb(255, 165, 0)")return"T";return null};var c=b.prototype,d=[["score",c.score],["reset",c.reset],["setPar",c.setPar],["translate",c.translate],["endGameScore",c.endGameScore]];common.exportSingleton("fitch",b,d)})();(function(){function h(a){return document.getElementById(a)}function g(a){return document.getElementById(a).style}function f(){}function e(){}function d(){}function a(){}a.prototype.color="";a.prototype.translate=function(a){if(a=="A")return 1;if(a=="G")return 2;if(a=="C")return 3;if(a=="T")return 4;return null};a.prototype.getColor=function(a){switch(a){case 1:color="#71B2E2";break;case 2:color="#9932CC";break;case 3:color="#008000";break;case 4:color="#FFA500";break;default:color=null;break}return color};a.prototype.buildRootAncester=function(a,b,c,d){if(document.getElementById("ancestor")==null){var e=document.createElement("div");e.id="ancestor";document.getElementById("sandbox").appendChild(e);$("#ancestor").addClass("ancestor")}var f="";var g=function(a){if(a=="A")return"#71B2E2";else if(a=="G")return"#9932CC";else if(a=="C")return"#008000";else if(a=="T")return"#FFA500";else return""};for(var h=0;h<d.length;h++){var i=a*c.yMargin+a*c.y+4;var j=b*c.xMargin+b*h+2;f+="<div class='ancestorSequence' style='height:"+(a-2)/2+"px;width:"+(b-2)+"px;left:"+j+"px;top:"+i+"px;background-color:"+g(d[h])+"'></div>"}$("#ancestor").html(f)};a.prototype.build=function(a,b,c,d){var e="";for(var f=0;f<d.length;f++){e+="<div class='row' id='row"+f+"'>";var g=0;for(var h=0;h<d[f].length;h++){var i=d[f].charAt(h);if(i!="_"){var j=a*c.yMargin+a*f+2;var k=b*c.xMargin+b*h+2;e+="<div class='sequence' id='"+(f*c.seqLen+g)+"' style='height:"+(a-2)+"px;width:"+(b-2)+"px;left:"+k+"px;top:"+j+"px;background-color:"+this.getColor(this.translate(i))+"'></div>";g++}}var j=a*c.yMargin+a*f+a/2.4;var k=b*c.xMargin+2;e+="<div class='redLine' id='red"+f+"' style='display:none;height:"+a/4+"px;width:"+(b*c.x-2)+"px;left:"+k+"px;top:"+j+"px'></div>";e+="</div>"}return e};var b=a.prototype,c=[["buildAncester",b.buildAncester]];common.exportSingleton("seq",a,c);d.prototype.build=function(a,b,c){var d="<div>";for(var e=0;e<c.y;e++){for(var f=0;f<c.x;f++){var g=b*c.yMargin+b*e;var h=a*c.xMargin+a*f;d+="<div class='bgGrid' style='top:"+g+"px;left:"+h+"px;height:"+(b-2)+"px;width:"+(a-2)+"px'></div>"}}d+="</div>";return d};e.prototype.alt=function(a){bug.lightbox(a)};f.prototype.renderConfig=function(){var a=document,b=window;var c=Math.abs(b.innerWidth/(25+1.2+1));if(window.option==true){c=Math.abs(b.innerWidth*.8/(25+1.2+1));window.optionScale=b.innerWidth*.1}var d=c;if(common.checkDevice()=="other"){var e={y:10,x:25,xMargin:1.2,yMargin:2,seqLen:30,xPx:c,yPx:d}}else if(common.checkDevice()=="ipad"){var e={y:10,x:25,xMargin:1.2,yMargin:2,seqLen:30,xPx:c+4,yPx:d+4}}else{c=Math.abs(b.innerWidth/(25+1.2));d=c;var e={y:8,x:25,xMargin:.6,yMargin:1.2,seqLen:30,xPx:c,yPx:d}}return e};f.prototype.renderEngine=function(b,c){$("#playButton").remove();$("#splashLogo").remove();if(b.getElementById("compactTree")!=undefined)$("#compactTree").remove();gameID.generate();var f=new e;var g=new d;var h=new a;var i=comm.init;var j=function(a){var b=document.createElement("div");b.id=a;document.getElementById("sandbox").appendChild(b)};if(window.option==true){$("#sandbox").css({left:c.innerWidth*.1,position:"absolute"})}var k=this.renderConfig();var l="";gData=animate.getSeq();l=g.build(k.xPx,k.yPx,k);l+=h.build(k.xPx,k.yPx,k,gData);this.prepareGridTracking(gData,k);this.gData=gData;l+="<div id='fitch' class='fitch'><div id='score'></div></div>";j("grids");$("#grids").html(l);$(".bgGrid").each(function(){$(this).css("display","none")});this.ancestor=i;animate.init(k);footer.adjust("play",{gs:k});this.domCache=this.createDomCache(k);i.setSettings(k,gData,this.Grid,this.createDomCacheWithStyle(k))};f.prototype.getJsonAlignments=function(){var a=this.Grid;var b=this.domCache;var c="[";for(var d=0;d<a.length;d++){c+='"';for(var e=0;e<a[0].length;e++){if(a[d][e]=="x"){c+="-"}else{c+=fitch.translate(b[a[d][e]].backgroundColor)}}c+='"';if(d<a.length-2)c+=","}return'{ "alignments" : '+c+"] }"};f.prototype.createDomCacheWithStyle=function(a){var b=[],c=this.Grid;for(var d=0,e=a.y,f=a.x;d<e*f;d++){b.push(0)}for(var d=0,g=c.length;d<g;d++){for(var h=0,i=c[d].length;h<i;h++){if(c[d][h]!="x"){b[c[d][h]]=document.getElementById(c[d][h])}}}for(var d=0,h=b.length;d<h;d++)if(b[d]==undefined)b[d]=0;return b};f.prototype.createDomCache=function(a){var b=[],c=this.Grid;for(var d=0,e=a.y,f=a.x;d<e*f;d++){b.push(0)}for(var d=0,h=c.length;d<h;d++){for(var i=0,j=c[d].length;i<j;i++){if(c[d][i]!="x"){b[c[d][i]]=new g(c[d][i])}}}for(var d=0,i=b.length;d<i;d++)if(b[d]==undefined)b[d]=0;return b};f.prototype.dumpGrid=function(){if(document.getElementById("dumpGrid")==null){var a=document.createElement("div");a.id="dumpGrid";document.body.appendChild(a);$("#dumpGrid").css("position","absolute");$("#dumpGrid").css("z-index","101");$("#dumpGrid").css("border-style","solid");$("#dumpGrid").css("right","0")}var b="";for(var c=0;c<this.Grid.length;c++){for(var d=0;d<this.Grid[c].length;d++){b+=" "+this.Grid[c][d]}b+="<br>"}$("#dumpGrid").html(b)};f.prototype.prepareGridTracking=function(a,b){this.Grid=[];for(var c=0;c<b.y;c++){var d=[];var e=0;for(var f=0;f<b.x;f++){if(c<a.length&&f<a[c].length){if(a[c].charAt(f)!="_"){d.push(c*b.seqLen+e);e++}else d.push("x")}else d.push("x")}this.Grid.push(d)}};f.prototype.updateGrid=function(a){this.Grid=a.slice(0)};f.prototype.gameEngine=function(a,b,c,d){var e=this;var f=a.xPx,g=a.yPx;c=fitch.algo(e.Grid,a,e.gData,c,d);if(common.checkDevice()=="other"){$(".sequence").each(function(){$(this).unbind("mouseup");$(this).unbind("mousedown")})}else{$(".sequence").each(function(){$(this).unbind("touchmove");$(this).unbind("touchend")})}$(".current").each(function(){var b=parseInt(this.id.replace(/row/,""));$(this).children().each(function(){if($(this).hasClass("sequence")){var f=this;if(common.checkDevice()=="other"){$(this).mousedown(function(g){$(document).mousemove(function(c){c.preventDefault();$("#red"+b).show("fast");e.move(f,c,a);mcb.run("onMoveStart")});$(document).mouseup(function(g){$("#red"+b).hide("fast");$(document).unbind("mousemove");$(document).unbind("mouseup");e.snap(f,g,a);c=fitch.algo(e.Grid,a,e.gData,c,d);mcb.run("onMoveStop")})})}else{var g=this;var h=function(c){if($(g).hasClass("blackoutseq")){return}c.preventDefault();$("#red"+b).show("fast");$(c.changedTouches).each(function(){e.move(f,this,a);mcb.run("onMoveStart")})};var i=function(g){$(g.changedTouches).each(function(){if(!g.targetTouches.length){$("#red"+b).hide("fast");e.snap(f,this,a);c=fitch.algo(e.Grid,a,e.gData,c,d);mcb.run("onMoveStop")}})};this.ontouchmove=h;this.ontouchend=i;this.ontouchstart=function(){$("#multiSelectBox").hide()}}}})})};f.prototype.movePhysicsLoop=function(a,b,c,d,e){var f=parseInt(b);var g=this.domCache;var h=window.optionScale;if(a){while(true){g[f].zIndex=100-e;var i=e*d.xPx+d.xPx/2;var j=c.pageX-h+i;var k=d.xPx*d.xMargin+d.xPx*d.x;var l=c.pageX-h+e*d.xPx-d.xPx/2;if(j>k){break}if(g[f+1]!=0){if(g[f+1]==undefined){g[f].left=l+"px";break}if(c.pageX-window.optionScale+e*d.xPx>parseInt(g[f+1].left)-d.xPx*.5){g[f].left=l+"px";e++}else{g[f].left=l+"px";break}}else{g[f].left=l+"px";break}f+=1;if(g[f]==0)break;if(g[f]==undefined)break}}else{while(true){g[f].zindex=100+j;var i=e*d.xPx-d.xPx/2;var j=d.xPx*d.xMargin;var k=c.pageX-h+i;var l=c.pageX-h+e*d.xPx-d.xPx*.5;if(j>k){break}if(g[f-1]!=0){if(g[f-1]==undefined){g[f].left=l+"px";break}if(parseInt(g[f-1].left)>c.pageX-h+e*d.xPx-d.xPx*1.5){g[f].left=l+"px";e--}else{g[f].left=l+"px";break}}else{g[f].left=l+"px";break}f-=1;if(g[f]==undefined)break;if(g[f]==0)break}}return};f.prototype.move=function(a,b,c){var d=parseInt($(a).css("left").replace(/px/,""));if(b.pageX-window.optionScale-c.xPx/2>d){this.movePhysicsLoop(true,parseInt(a.id),b,c,0)}else if(b.pageX-window.optionScale-c.xPx/2==d){return}else{this.movePhysicsLoop(false,parseInt(a.id),b,c,0)}};f.prototype.log=function(a){if(!window["console"]){if(window["loadFirebugConsole"]){window.loadFirebugConsole()}else{var b=function(a,b,c,d,e,f,g,h,i,j,k){if(a.getElementById(e))return;k=a[b+"NS"]&&a.documentElement.namespaceURI;k=k?a[b+"NS"](k,"script"):a[b]("script");k[c]("id",e);k[c]("src",i+g+j);k[c](e,f);(a[d]("head")[0]||a[d]("body")[0]).appendChild(k);k=new Image;k[c]("src",i+h)};b(document,"createElement","setAttribute","getElementsByTagName","FirebugLite","4","firebug-lite.js","releases/lite/latest/skin/xp/sprite.png","https://getfirebug.com/","#startOpened")}}else{console.log("@log [BUG] > "+a)}};f.prototype.snap=function(a,b,c){var d=this;var e=function(a){var b=0;for(var c=0;c<d.gData[a].length;c++){if(d.gData[a][c]!="_")b++}return b};var f=function(a){var a=parseInt(a);for(var b=0;b<d.Grid.length;b++){if(b*c.seqLen<=a&&a<b*c.seqLen+30){break}}return b};var g=f(a.id);var h=e(g);var i=-1;var j=this.domCache;var k=c.xPx*c.xMargin;for(var l=0;l<h;l++){var m=g*c.seqLen+l;var n=l*c.xPx+k;var o=(c.x-(h-l))*c.xPx+k;var p=parseInt(j[m].left);if(j[m]!=0){if(n<p&&p<o){var q=(p-k)%c.xPx;var r=Math.round((p-q-k)/c.xPx+1);if(q>c.xPx/2)r+=1;if(r<l)r+=1;if(r>l)r-=1}if(l*c.xPx+k>p){r=l}else if(p>(c.x-(h-l))*c.xPx+k){r=c.x-(h-l)}if(r==i)r+=1;else if(i>r)r=i+1;i=r;if(window.DEBUG)console.log("@snap > grid 2 > "+r);$("#"+m).animate({left:r*c.xPx+k+2},300);j.zIndex=100;var s=d.Grid[g].indexOf(m);d.Grid[g][s]="x";d.Grid[g][Math.round(r)]=Math.floor(m)}}};var b=f.prototype,c=[["renderEngine",b.renderEngine],["renderConfig",b.renderConfig],["dumpGrid",b.dumpGrid],["gameEngine",b.gameEngine],["updateGrid",b.updateGrid],["getJsonAlignments",b.getJsonAlignments],["snap",b.snap]];common.exportSingleton("gameIDE",f,c)})();(function(){function g(){}g.prototype.registerLightbox=function(){if(document.getElementById("lightbox")==undefined){var a=document.createElement("div");a.className="lightbox";a.id="lightbox";document.body.appendChild(a)}};g.prototype.killLightbox=function(){var a=document;if(a.getElementById("lightbox")!=undefined)a.body.removeChild(a.getElementById("lightbox"))};g.prototype.getDocHeight=function(){var a=document;return Math.max(Math.max(a.body.scrollHeight,a.documentElement.scrollHeight),Math.max(a.body.offsetHeight,a.documentElement.offsetHeight),Math.max(a.body.clientHeight,a.documentElement.clientHeight))};g.prototype.getDocWidth=function(){var a=document;return Math.max(Math.max(a.body.scrollWidth,a.documentElement.scrollWidth),Math.max(a.body.offsetWidth,a.documentElement.offsetWidth),Math.max(a.body.clientWidth,a.documentElement.clientWidth))};g.prototype.buildLightbox=function(){this.registerLightbox();if(document.getElementById("lbContent")==undefined){var a=document.createElement("div");a.id="lbContent";a.className="lbContent";document.getElementById("lightbox").appendChild(a)}};g.prototype.lbContent=function(a){if(document.getElementById("lbContent")==undefined)this.buildLightbox();a()};g.prototype.sleep=function(){var a=document,b=window;var c=this;if(b.innerHeight>b.innerWidth&&common.checkDevice()!="other"){if(a.getElementById("sleep")==undefined){var d=a.createElement("div");d.id="sleep";d.style.height=screen.height;d.style.width=screen.width;d.style.zIndex="170";d.style.backgroundColor="black";d.style.opacity="0.9";d.style.position="absolute";a.getElementById("sandbox").appendChild(d);d.id="sleepMsg";d.style.zIndex="171";d.style.position="absolute";a.getElementById("sandbox").appendChild(d);var e;if(mcb.GET("lang")=="fr")e="<p> SVP faites pivoter votre appareil mobile!</p>";else e="<p>Sorry for the interupt! Please rotate your device into landscape mode!</p>";$("#sleepMsg").html(e);$("#sleepMsg").css("top","5em");$("#sleepMsg").css("fontSize","200%")}if(document.getElementById("menu").style.display!="none"&&common.checkDevice()!="ipad"){console.log("why am i here?");$("#sleep").html("");$("#sleepMsg").html("");return}b.setTimeout(function(){console.log("did i meet this");c.sleep()},1e3)}else{$("#sleep").html("");$("#sleepMsg").html("");if(common.checkDevice()=="other"^common.checkDevice()=="ipad")this.splashLogo(a,b);else this.displayGameMenu(a,b);return}};g.prototype.splashLogo=function(a,b){var c=new Image;var d=gameIDE.renderConfig();$("#sandbox").css({left:"",position:""});if(a.getElementById("playButton")==undefined){if(a.getElementById("splashPageWrapper")==undefined){var e=a.createElement("div");e.id="splashPageWrapper";a.getElementById("sandbox").appendChild(e)}if(mcb.cookie.read("PhyloFBLogin")!=null||mcb.cookie.read("PhyloLogin")!=null){var f=a.createElement("div");f.id="checkGuestContent";f.innerHTML=(mcb.GET("lang")=="en"?"Welcome back! Not ":"Bienvenue! Non ")+(mcb.cookie.read("PhyloFBLogin")==null?mcb.cookie.read("PhyloLogin"):mcb.cookie.read("PhyloFBLogin").replace(/\/.*/,""))+"? <a href='#' id='logout'><span style='position:relative;top:0.2em;'>"+(mcb.GET("lang")=="en"?"Log Out":"dÃ©connecter")+"</span></a>";a.getElementById("splashPageWrapper").appendChild(f);var g=mcb.deviceType=="desktop"?"35%":"20%";$("#checkGuestContent").css({top:"0%",left:g,zIndex:"151",width:"30%",height:"5px auto",position:"relative","border-radius":"0.5em","-webkit-border-radius":"0.5em","-moz-border-raidus":"0.5em","-khtml-border-radius":"0.5em",backgroundColor:"white",color:"black",padding:"0.2em 0 0.2em 0.2em"});$("#logout").css({position:"absolute",right:0,top:0,padding:"0em 2em",height:"100%",backgroundColor:"#71B2E2","border-radius":"0em 0.5em 0.5em 0","-webkit-border-radius":"0em 0.5em 0.5em 0","-moz-border-radius":"0em 0.5em 0.5em 0","-khtml-border-radius":"0em 0.5em 0.5em 0"})}c.src="http://phylo.cs.mcgill.ca/img/phylo_front_logo.png";c.id="splashLogo";c.className="phylo_logo1";a.getElementById("splashPageWrapper").appendChild(c);var f=a.createElement("a");f.id="playButton";f.className="phylo_play";if(mcb.GET("lang")=="fr")f.innerHTML="JOUEZ";else f.innerHTML="PLAY";f.href="#";a.getElementById("splashPageWrapper").appendChild(f);$("#splashPageWrapper").css({"min-width":688});var h=0;var i=function(){if(window.innerWidth>1024){var a=window.innerWidth-parseInt($("#splashPageWrapper").css("width").replace(/px/,""));if(a<0)a=0;$("#splashPageWrapper").css("left",a/2);if(window.innerWidth<1473){$("#playButton").css({top:window.innerHeight*.25,left:window.innerWidth*.45,position:"absolute",height:"5%"});$(".phylo_logo1").css({width:window.innerWidth,top:"-2.9em",position:"relative"});$(".phylo_logo2").css({left:"3em",width:window.innerWidth/3})}}else{if(window.innerWidth>668||h==0){$("#splashPageWrapper").css({left:""});$("#footer").css("left","");if(document.getElementById("checkGuestContent")==undefined){$(".phylo_logo1").css("top","-.9em")}$("#splashLogo").css({width:window.innerWidth,"float":"left"});$("#playButton").css({left:window.innerWidth/-1.7,"float":"left",top:window.innerHeight*.35,"font-size":"1.0em",height:"1.3em",position:"relative",zIndex:10});$("#splashLogo2").css({"float":"left",width:window.innerWidth/3,height:"","min-width":"0","min-height":"0",left:"3em"});$("#checkGuestContent").css({left:window.innerWidth/2.9})}}window.foot=function(){if(document.getElementById("gameMenu")!=undefined){$("#footer").css({left:a/2+100,top:document.getElementById("gameMenu").offsetHeight+110})}else{$("#footer").css({left:a/2+100,top:document.getElementById("splashLogo").offsetHeight})}};var b=window.foot;if(document.getElementById("splashLogo")!=undefined){if(document.getElementById("splashLogo").offsetHeight==0){window.setTimeout(function(){b()},500)}else b()}h=1};i();$(window).resize(function(){i()});var j=this;try{login.init()}catch(k){console.log("Login Code Broke");console.log(k)}$("#playButton").click(function(){j.displayGameMenu(a,b);$("#splashPageWrapper").hide()})}else{$("#splashPageWrapper").show()}};g.prototype.displayHTML5GameMenu=function(a,b){var c=gameIDE.renderConfig();var d=a.createElement("canvas");d.id="gameMenuCanvas";a.body.appendChild(d);if(window.option){$("#gameMenuCanvas").css("left",b.innerWidth*.1)}$("#gameMenuCanvas").css({position:"absolute",top:c.yMargin*c.xPx,height:c.y*c.xPx,width:c.x*c.yPx,zIndex:150});d=a.getElementById("gameMenuCanvas");var e=d.getContext("2d");e.beginPath();e.fillStyle="#FFFFFF";e.fillRect(0,0,c.x*c.xPx,c.y*c.yPx);e.closePath();e.fill();console.log("height "+c.y*c.xPx+" width "+c.x*c.xPx);e.fillStyle="red";e.font="36pt Arial";e.fillText(" Failed...",50,40);e.fillText("< Play >",50,100)};g.prototype.getSeq=function(){return this.collectedSeq};g.prototype.getGameTree=function(){if(window.DEBUG)console.log(this.format);return this.format};g.prototype.buildGameTree=function(a){var b=0,c=0;var d=[];this.format=[];var e=this.format;var f=function(a,g){if(a.name.constructor.toString().indexOf("Array")==-1){if(a.name!=""){return a.name}}if(a.branchset!=undefined)if(a.branchset.constructor.toString().indexOf("Array")==-1){f(a.branchset,g+1)}else{var h=f(a.branchset[0],g+1);var j=f(a.branchset[1],g+1);if(typeof h=="string"&&typeof j=="string"){if(h!=""&&j!=""){var l={lv:b++,depth:g,child:0,node1:c++,node2:c++,p1:h,p2:j};e.push(l);return l}}else if(typeof h=="string"&&typeof j=="object"||typeof h=="object"&&typeof j=="string"){if(h==""){if(d.length<1)d.push(j);else{h=d.pop();if(typeof j=="object"&&typeof h=="object"){var l={lv:b++,depth:g,child:2,node1:h.lv,node2:j.lv};e.push(l);return l}else if(typeof j=="object"){var l={lv:b++,depth:g,child:1,node1:c++,node2:j.lv,p1:h};e.push(l);return l}else if(typeof h=="object"){var l={lv:b++,depth:g,child:1,node1:c++,node2:h.lv,p1:j};e.push(l);return l}}}else if(j==""){if(d.length<1)d.push(h);else{j=d.pop();if(typeof j=="object"&&typeof h=="object"){var l={lv:b++,depth:g,child:2,node1:h.lv,node2:j.lv};e.push(l);return l}else if(typeof j=="object"){var l={lv:b++,depth:g,child:1,node1:c++,node2:j.lv,p1:h};e.push(l);return l}else if(typeof h=="object"){var l={lv:b++,depth:g,child:1,node1:c++,node2:h.lv,p1:j};e.push(l);return l}}}else{if(typeof j=="object"&&typeof h=="object"){var l={lv:b++,depth:g,child:2,node1:h.lv,node2:j.lv};e.push(l);return l}else if(typeof j=="object"){var l={lv:b++,depth:g,child:1,node1:c++,node2:j.lv,p1:h};e.push(l);return l}else if(typeof h=="object"){var l={lv:b++,depth:g,child:1,node1:c++,node2:h.lv,p1:j};e.push(l);return l}}}else if(typeof h=="object"&&typeof j=="object"){var l={lv:b++,depth:g,child:2,node1:h.lv,node2:j.lv};e.push(l);return l}}return""};f(a,0)};g.prototype.endGameMenu=function(value){$("#game-star").unbind("click");var gs=this.gs;var f=this;var nice=false;if(value==0){nice=true}else{}$("#sandbox").append("<div id='endGameMenu'><div id='endGameMenu-context'><div id='endGameMenu-body'></div></div></div>");$("#endGameMenu").css({position:"absolute",top:$("#menu").css("display")=="block"?document.getElementById("menu").offsetHeight:0,left:-parseInt($("#sandbox").css("left")),height:parseInt(window.innerHeight)-$("#sandbox").offset().top,width:parseInt(screen.availWidth)+parseInt($("#sandbox").css("left")),"background-color":"#000000",opacity:"0.95","z-index":"180"});if(common.checkDevice()=="ipad"){$("#endGameMenu").css({width:parseInt(screen.availWidth)+parseInt($("#sandbox").css("left"))*3})}$("#endGameMenu-context").css({position:"relative",top:$("#menu").css("display")=="block"?parseInt($("#menu").css("height"))+parseInt($("#menu").css("top")):gs.yPx*gs.xMargin,left:parseInt($("#sandbox").css("left")),height:gs.yPx*gs.y,width:gs.xPx*gs.x,"z-index":"181","border-style":"solid","border-width":"1px","border-color":"#FFFFFF","background-color":"#303030"});var score=fitch.endGameScore();var content="";if(!nice){if(score.stage==score.stageLength-1&&score.score>=score.par)nice=true}mcb.setWinLoose(nice);mcb.run("gameEnd");if(nice)if(mcb.GET("lang")=="fr")context="Félications! Vous avez terminé l'étage finale, et nous avons soumis votre solution. <br>";else context="Congratulations! You've completed the final stage, and we just submitted your alignment for this session. <br>";else{if(mcb.GET("lang")=="fr")context="Malheureusement, vous avez manqué de temps, donc aucune solution a été soumise. <br>";else context="Unfortunately, you ran out of time before reaching the final stage, so your alignment was not submitted this session.<br>"}context+="<br>";$("#endGameMenu-context").html("<div id='endGameMenu-context-header'></div><div id='endGameMenu-context-body'></div><div id='endGameMenu-button'></div></div>");$("#endGameMenu-button").html("<a href='#' id='newGame' class='endGameMenu-button'>New Game</a><a href='#' id='replayGame' class='endGameMenu-button'>Replay Game</a>");var f=this;$("#newGame").click(function(){$("#sandbox").html("");$("#sandbox").css("left","");f.displayGameMenu(document,window)});$("#replayGame").click(function(){$("#sandbox").html("");$("#sandbox").css("left","");f.start(document,window)});$(".endGameMenu-button").css({"padding-left":"20%","padding-right":"20%"});if(common.checkDevice()!="other"&&common.checkDevice()!="ipad"){}else{$("#endGameMenu-context-header").css({position:"relative",top:"0",height:"30%",width:"90%",left:"30%"});$("#endGameMenu-context-body").css({position:"relative",left:"5%",height:"70%",width:"90%","overflow-y":"scroll","overflow-x":"hidden"})}document.getElementById("endGameMenu-context-header").appendChild(images.get("thankyou"));$("#thankyou").css({height:"100%"});var roundID=this.roundID;var url="../phpdb/phyloDB2.php";loading.install();if(nice){$.post(url,{mode:4,id:roundID,user:window.guest,align:gameIDE.getJsonAlignments(),score:score.score},function(data){loading.uninstall();try{var json=eval("["+data+"]")}catch(err){if(mcb.GET("lang")=="fr")bug.lightbox("Oops! Le serveur a planté!<br> Nous ne pouvions pas vous dire le résultat.<br>S'il vous plaît réessayer plus tard.");else bug.lightbox("Oops! The Server Crashed!<br> We couldnt tell you the result.<br>Please Try again later");console.log(data);return}json=json[0];if(mcb.GET("lang")=="fr"){context+="Vous avez joué au niveau <label class='end-color'>"+f.roundID+"</label>. Rappelez-vous cette identité si vous souhaitez jouer à ce niveau encore plus tard!<br> L'ADN de ce niveau a été liée à: <label class='end-color'>"+json.disease_link+"</label>.<br><br>Ce niveau a été complété <label class='end-color'>"+json.play_count+"</label> fois.<br>Les autre joueurs n'ont pas réussi à compléter ce niveau <label class='end-color'>"+json.fail_count+"</label> fois.<br><br>Le meilleur score pour ce niveau est: <label class='end-color'>"+json.best_score+"</label>.<br>Le score moyen pour ce niveau est: <label class='end-color'>"+Math.round(json.running_score/json.play_count)+"</label>.<br><br>";context+="<label class='end-color'>"+json.highscore_user+"</label> a le meilleur score pour ce niveau.<br><br>"}else{context+="You played level <label class='end-color'>"+f.roundID+"</label>. Remember this ID if you wish to play this level again later!<br> The DNA in this puzzle has been linked to: <label class='end-color'>"+json.disease_link+"</label>.<br><br>This level has been completed <label class='end-color'>"+json.play_count+"</label> times.<br>Users have failed to reach this level <label class='end-color'>"+json.fail_count+"</label> times.<br><br>The high score for this level is: <label class='end-color'>"+json.best_score+"</label>.<br>The average score for this level is: <label class='end-color'>"+Math.round(json.running_score/json.play_count)+"</label>.<br><br>";context+="<label class='end-color'>"+json.highscore_user+"</label> has the highest score for this level.<br><br>"}$("#endGameMenu-context-body").html(context)}).error(function(){loading.uninstall();if(mcb.GET("lang")=="fr")bug.lightbox("Oops! Pas de connexion.<br> Etes-vous connecté à Internet?");else bug.lightbox("Oops! We couldnt connect to the server.<br>We suspect you are not connected to the internet!")})}else{$.post(url,{mode:3,id:roundID},function(data){loading.uninstall();try{var json=eval("["+data+"]")}catch(err){if(mcb.GET("lang")=="fr")bug.lightbox("Oops! Le serveur a planté!<br> Nous ne pouvions pas vous dire le résultat.<br>S'il vous plaît réessayer plus tard.");else bug.lightbox("Oops! The Server Crashed!<br> We couldnt tell you the result.<br>Please Try again later");console.log(data);return}json=json[0];if(mcb.GET("lang")=="fr"){context+="Vous avez joué au niveau <label class='end-color'>"+f.roundID+"</label>. Rappelez-vous cette identité si vous souhaitez jouer à ce niveau encore plus tard!<br>L'ADN de ce niveau a été liée à: <label class='end-color'>"+json.disease_link+"</label>.<br><brCe niveau a été complété <label class='end-color'>"+json.play_count+"</label> fois.<br>Les autre joueurs n'ont pas réussi à compléter ce niveau <label class='end-color'>"+json.fail_count+"</label> fois.<br><br>Le meilleur score pour ce niveau est: <label class='end-color'>"+json.best_score+"</label>.<br>Le score moyen pour ce niveau est: <label class='end-color'>"+Math.round(json.running_score/json.play_count)+"</label>.<br><br>";context+="<label class='end-color'>"+json.highscore_user+"</label > a le meilleur score pour ce niveau.<br><br>"}else{context+="You played level <label class='end-color'>"+f.roundID+"</label>. Remember this ID if you wish to play this level again later!<br> The DNA in this puzzle has been linked to: <label class='end-color'>"+json.disease_link+"</label>.<br><br>This level has been completed <label class='end-color'>"+json.play_count+"</label> times.<br>Users have failed to reach this level <label class='end-color'>"+json.fail_count+"</label> times.<br><br>The high score for this level is: <label class='end-color'>"+json.best_score+"</label>.<br>The average score for this level is: <label class='end-color'>"+Math.round(json.running_score/json.play_count)+"</label>.<br><br>";context+="<label class='end-color'>"+json.highscore_user+"</label> has the highestscore for this level.<br><br>"}$("#endGameMenu-context-body").html(context)}).error(function(){loading.uninstall();if(mcb.GET("lang")=="fr")bug.lightbox("Oops! Pas de connexion.<br> Etes-vous connecté à Internet?");else bug.lightbox("Oops! We couldnt connect to the server.<br>We suspect you are not connected to the internet!")})}};g.prototype.getDiseaseList=function(){var a=[["digestive",[95,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,698,699,700,701,702,703,704,705,706,707,708,709,710,711,712,713,714,715,716,717,718,719,720,721,722,723,724,725,726,727,728,729,730,731,732,733,734,735,736,737,738,739,740,741,742,743,744,745,746,747,748,749,750,751,752,753,754,755,756,757,758,759,760,761,762,763,764,765,766,767,768,769,770,771,772,773,774,775,776,777,778,2103,2104,2105,2106,2107,2108,2109,2110,2111,2112,2113,2114,2115,2116,2117,2118,2119,2120,2121,2122,2123,2124,2125,2126,2127,2128,2129,2130,2131,2132,2133,2134,2135,2136,2137,2138,2139,2140,2141,2142,2143,2144,2145,2146,2147,2148,2149,2150,2151,2152,2153,2154,2155,2156,2157,2158]],["heart",[378,378,379,380,381,382,383,384,385,386,557,558,559,560,561,562,563,564,565,566,567,568,569,570,571,572,2008,2009,2010,2011,2012,2013,2014,896,897,898,899,900,901,902,903,904,905,906,907,908,909,910,911,912,913,914,915,916,917,918,919,920,921,922,923,924,925,926,927,928,929,930,931,932,933,934,935,936,937,938,939,940,941,942,943,944,945,946,947,948,949,950,951,952,953,954,955,956,957,958,959,960,961,962,963,964,965,966,967,968,969,970,971,972,973,974,975,976,977,978,979,980,981,982,983,984,985,986,987,988,989,990,991,992,993,994,995,996,997,998,999,1e3,1001,1002,1003,1004,1005,1006,1007,1008,1009,1010,1011,1012,1013,1014,1015,1016,1017,1018,1019,1020,1021,1022,1023,1024,1025,1026,1027,1028,1029,1030,1031,1032,1033,1034,1035,1036,1037,1038,1039,1040,1249,1250,1251,1252,1253,1254,1255,1256,1257,1258,1259,1260,1261,1262,1263,1264,1265,1266,1267,1268,1269,1270,1271,1272,1273,1274,1275,573,574,575,576,577,1390,1391,1392,1393,1394,1395,1175,1176,1177,1178,1179,1180,663,664,665,666,667,668,669,670,671,672,673,674,675,676,677,678,679,680,681,682,683,684,685,686,687,688,689,690,691,692]],["cancer",[124,124,125,126,127,128,129,130,131,132,133,134,135,136,482,483,484,485,486,487,488,489,490,491,492,493,494,495,496,497,498,499,500,506,507,508,509,510,1068,1069,1070,1071,1072,1073,1074,1075,1076,1077,1078,1079,1080,1812,1813,1814,1815,580,581,582,583,584,585,586,1535,1536,1537,1538,1539,1540,1541,1542,1543,1544,1545,1546,1547,1548,1549,1550,1551,1552,1553,1554,1555,1556,1557,1558,1559,1560,1561,1562,1563,1564,1565,1566,1567,1568,1569,1570,1571,1572,1573,1574,1575,1576,1577,1578,1579,1580,1581,1582,1583,1584,1585,1586,1587,1588,1589,1590,1591,1592,1593,1594,1595,1596,1597,1598,1599,1833,1834,1835,1836,1837,1838,1839,1840,1841,1842,1843,1844,1845,1846,1847,1848,1849,1850,1851,1852,1853,1854,1855,1856,1857,1858,1859,1860,1861,1862,1863,1864,1865,1866,1867,1868,1869,1870,1871,1872,1873,1874,1875,1876,1877,1878,1879,601,602,603,604,605,1662,1663,1664,1665,1666,1667,1668,1669,1670,1671,1672,1673,1674,1675,1676,1677,1678,1679,1680,1681,1682,1683,1684,1685,1686,1687,1688,1689,1690,1691,1692,1693,1694,1695,1696,1697,1698,1699,1700,1701,1702,1703,1704,1705,1706,1707,1708,1709,1710,1711,1712,1713,1714,1715,1716,1717,1718,1719,1720,1721,1722,1723,1724,1725,1726,1727,1728,1729,1730,1731,1732,1733,1734,1735,1736,1737,1738,1739,1740,1741,1742,1743,1744,1745,1746,1747,1748,1749,1750,1751,1752,1753,1754,1755,1756,1757,1758,1759,1760,1761,1762,1763,1764,1765,1766,1767,1768,1769,658,659,660,661,693,694,695,696,697,511,512,513,514,515,516,517,1788,1789,1790,1791,1792,1793,1794,1795,1796,1797,1798,1799,1800,1801,1802,1803,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,802,803,804,805,806,807,808,809,810,811,812,305,306,307,308,309,310,311,312,313,314,315,316,317,1286,1287,1288,1289,1290,1291,1292,1293,1294,1295,1296,1297,1298,1299,1300,1301,1302,1303,1304,1305,1306,1307,1308,1309,1310,1311]],["metabolic",[1773,1773,1774,1775,1776,1777,1778,1779,1780,1781,1782,1783,1784,1785,1786,1787,389,390,391,1804,1805,1806,1807,1808,1809,1810,1811,578,579,1531,1532,1533,1497,1498,1499,1500,1501,1502,1503,1504,1505,1506,1507,1508,1509,1510,1511,1512,1513,1514,1515,1516,1517,1518,1519,1520,1521,1522,1523,1524,1525,1880,1881,1882,1883,1884,1885,1886,1887,1888,1889,1890,1891,1892,1893,1894,1895,1896,1897,1898,1899,1900,1901,1902,1903,1904,1905,1906,1907,1908,1909,1910,1653,1654,1655,1656,1657,1658,1659,1660,1661,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,467,468,469,1611,1612,1613,1614,1615,1616,1617,1618,1619,1620,1621,1622,1623,1624,1625,1626,1627,1628,1629,1630,1631,1632,1633,1634,1635,1636,1637,1638,1639,1640,1641,1642,1643,1644,1645,1646,1647,518,519,520,521,522,523,524,525,526,527,528,529,530,531,532,533,534,535,536,537,538,539,540,541,542,480,481,1820,1821,1822,1823,1824,1825,556,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1134,1135,1136,1137,1138,1139,1140,1141,1142,1143,1144,1145,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,1453,1454,1455,1456,1457,1458,1459,1460,1461,1462,1463,1464,1465,606,607,608,609,610]],["blood",[252,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,1600,1601,1396,1397,1398,1399,1400,1401,1402,1403,1404,1405,1406,1407,1408,1409,1410,1411,1412,1413,1414,1415,1416,1417,1418,1419,1420,1421,1422,1423,1424,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,2159,1093,1094,1095,1096,1097,1098,1099,1100,1101,1102,1103,1104,1105,1106,1107,1108,1109,1110,1111,1112,1113,1114,1115,1116,1117,1118,1119,1425,1426,1427,1428,1472,1473,1474,1475,1476,1477,1478,1479,1480,1481,1482,1483,1484,1485,1486,1487,1488,1489,1490,1491,1492,1493]],["sensory",[470,470,471,472,473,474,475,476,477,478,479,1312,1313,1314,1315,1316,1317,1318,1319,1320,1321,1322,1323,1324,1325,1326,1327,1328,1329,1330,1331,1332,1333,1334,1335,1336,1337,1338,1339,1340,1341,1342,1343,1344,1345,1346,1347,1348,1349,1350,1351,1352,1353,1354,1355,1356,1357,1358,1359,1360,1361,1362,1363,1364,1365,1366,1367,1368,1369,1370,1371,1372,1373,1374,1375,1376,1377,1378,1379,1380,1381,1382,1383,1384,1385,1386,1387,1388,1186,1187,620,621,622,623,1197,1198,1199,1200,1201,1202,1203,1204,1205,1206,1207,1208,1209,1210,1211,1212,1213,1214,1215,1216,1217,1218,1219,1220,1221,1222,1223,1224,1225,1226,1227,1228,1229,1230,1231,1232,1233,1234,1235,1236,1237,1238,1239,1240,1241,1242,1243,1244,1245,1246,1247,1248,627,628,629,630,631,632,633,634,635,636,637,638,639,640,641,642,387,388,1120,1121,1122,1123,1124,1125,1126,1127,1128,1129,1130,1131,1132,1133,1081,1082,1083,1084,1085,1086,643,644,645,646,647,648,649,650,651]],["brain",[1,1,2,3,2023,2024,2025,2026,2027,2028,2029,2030,2031,2032,2033,2034,2035,2036,2037,2038,2039,2040,2041,2042,2043,2044,2045,2046,2047,2048,2049,2050,2051,2052,2053,2054,2055,2056,2057,2058,2059,2060,2061,2062,2063,2064,2065,2066,2067,2068,2069,2070,2071,2072,2073,2074,2075,2076,2077,2078,2079,2080,2081,2082,2083,2084,2085,2086,2087,2088,1816,1817,1818,1819,2089,2090,2091,2092,2093,2094,2095,2096,2097,2098,2099,2100,2101,2102,501,502,503,504,505,1056,1057,1058,1059,1060,1061,779,780,781,782,783,784,785,786,787,788,1062,1063,1064,1065,1066,1067,158,159,160,161,162,163,164,165,1149,1150,1151,1152,1153,1154,1155,1156,1157,1158,1159,1160,1161,1162,1163,1164,1165,1166,1167,1168,1169,1170,1171,1172,1173,1174,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434,435,436,437,438,439,440,441,442,443,444,445,446,447,448,449,450,451,452,453,454,455,456,457,458,459,460,118,119,1911,1912,1913,1914,1915,1916,1917,1918,1919,1920,1921,1922,1923,1924,1925,1926,1927,1928,1929,1930,1931,1932,1933,1934,1935,1936,1937,1938,1939,1940,1941,1942,1943,1944,1945,1946,1947,1948,1949,1950,1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1146,1147,1148,543,544,545,546,547,548,549,550,551,552,553,789,790,791,792,793,794,795,796,797,798,799,800,801,878,879,880,881,882,883,884,885,886,887,888,889,890,891,892,893,894,895,1963,1964,1965,1966,1967,1968,1969,1970,1971]],["muscles",[252,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,1600,1601,1396,1397,1398,1399,1400,1401,1402,1403,1404,1405,1406,1407,1408,1409,1410,1411,1412,1413,1414,1415,1416,1417,1418,1419,1420,1421,1422,1423,1424,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,2159,1093,1094,1095,1096,1097,1098,1099,1100,1101,1102,1103,1104,1105,1106,1107,1108,1109,1110,1111,1112,1113,1114,1115,1116,1117,1118,1119,1425,1426,1427,1428,1472,1473,1474,1475,1476,1477,1478,1479,1480,1481,1482,1483,1484,1485,1486,1487,1488,1489,1490,1491,1492,1493]],["lung",[252,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,1600,1601,1396,1397,1398,1399,1400,1401,1402,1403,1404,1405,1406,1407,1408,1409,1410,1411,1412,1413,1414,1415,1416,1417,1418,1419,1420,1421,1422,1423,1424,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,2159,1093,1094,1095,1096,1097,1098,1099,1100,1101,1102,1103,1104,1105,1106,1107,1108,1109,1110,1111,1112,1113,1114,1115,1116,1117,1118,1119,1425,1426,1427,1428,1472,1473,1474,1475,1476,1477,1478,1479,1480,1481,1482,1483,1484,1485,1486,1487,1488,1489,1490,1491,1492,1493]]];return a};g.prototype.displayGameMenu=function(doc,win){$("#sandbox").css({left:"",position:""});var f=this;var gMenu={random:function(){$("#gameContent").html("");var data="";var color=["#71B2E2","darkOrchid","green","orange"];for(var i=3;i<=8;i++)data+="<a href='#' class='gameOpt' style='background-color:"+color[i-3>3?i-7:i-3]+";'>"+i+"</a>";data+="<div id='gameFootNote'><div class='g-line'>Easy</div><div id='gline' class='g-line'></div><div class='g-line'>Hard</div></div>";$("#gameContent").html(data);$(".gameOpt").click(function(){var url="../phpdb/phyloDB2.php";var score=$(this).html();loading.install();$.post(url,{mode:1,diff:score},function(data){$("#gameMenu").hide();loading.uninstall();data=data.replace("@","");try{var json=eval("["+data+"]")}catch(err){console.log(data);if(mcb.GET("lang")=="fr")bug.lightbox("Oops! Le serveur a planté!<br> S'il vous plaît réessayer plus tard.");else bug.lightbox("Oops! The Server Crashed!<br> Please Try again later");return}json=json[0].level;f.roundID=json.attributes.id;for(var i=0;i<json.sequence.length;i++){json.sequence[i]=json.sequence[i].replace(/-/g,"_").toUpperCase()}f.collectedSeq=json.sequence;if(window.DEBUG)console.log(json.tree);var tree=newick.parse(json.tree);f.buildGameTree(tree);f.start(doc,win)}).error(function(){loading.uninstall();if(mcb.GET("lang")=="fr")bug.lightbox("Oops! Pas de connexion.<br> Etes-vous connecté à Internet?");else bug.lightbox("Oops! We couldnt connect to the server.<br>We suspect you are not connected to the internet!")})})},level:function(){$("#gameContent").html("");var data="<div id='game-level'>Enter Level ID:<br><input id='game-level-id' class='game-input' type='text'/><br><a href='#' id='game-level-submit'>Submit</a></div>";$("#gameContent").html(data);if(common.checkDevice()!="other"&&common.checkDevice()!="ipad"){$("#game-level").css({zIndex:"172",position:"relative",top:parseInt($("#gameContent").css("height"))*3/10,left:parseInt($("#gameContent").css("width"))*.5/10})}else{$("#game-level").css({zIndex:"172",position:"relative",top:parseInt($("#gameContent").css("height"))*2/10,left:parseInt($("#gameContent").css("width"))*2.5/10})}$("#game-level-submit").click(function(){var url="../phpdb/phyloDB2.php";var id=$.trim($("#game-level-id").val());if(id==""){if(mcb.GET("lang")=="fr")bug.lightbox("Oops! SVP entrer un niveau valide");else bug.lightbox("Oops! Please enter a valid Level ID");return}loading.install();$.post(url,{mode:2,id:id},function(data){loading.uninstall();if(data==""){bug.lightbox("Incorrect ID")}else{data=data.replace("@","");try{var json=eval("["+data+"]")}catch(err){console.log(data);if(mcb.GET("lang")=="fr")bug.lightbox("Oops! Pas de connexion.<br> Etes-vous connecté à Internet?");else bug.lightbox("Oops! We couldnt connect to the server.<br>We suspect you are not connected to the internet!");return}$("#gameMenu").hide();json=json[0].level;f.roundID=json.attributes.id;for(var i=0;i<json.sequence.length;i++){json.sequence[i]=json.sequence[i].replace(/-/g,"_").toUpperCase()}f.collectedSeq=json.sequence;if(window.DEBUG)console.log(json.tree);var tree=newick.parse(json.tree);f.buildGameTree(tree);f.start(doc,win)}}).error(function(){loading.uninstall();if(mcb.GET("lang")=="fr")bug.lightbox("Oops! Pas de connexion.<br> Etes-vous connecté à Internet?");else bug.lightbox("Oops! We couldnt connect to the server.<br>We suspect you are not connected to the internet!")})})},disease:function(){var disease=f.getDiseaseList();$("#gameContent").html("");var data="";var color=[["digestive","../img/digestive.png","150px",""],["heart","../img/heart.png","110px","30px"],["cancer","../img/cancer.png","100px","55px"],["metabolic","../img/metabolic.png","100px",""],["blood","../img/blood.png","50px","10px"],["sensory","../img/sensory.png","60px","30px"],["brain","../img/brain.png","80px",""],["muscles","../img/muscles.png","60px",""],["lung","../img/lung.png","60px",""]];for(var i=0;i<color.length;i++){data+="<a href='#' class='gameDisease' id='d"+i+"'><img src='"+color[i][1]+"' style='position:relative;left:"+color[i][3]+";height:"+color[i][2]+";padding-bottom:1em;'/></a>"}$("#gameContent").html(data);$(".gameDisease").click(function(){loading.install();var url="../phpdb/phyloDB2.php";var name=parseInt($(this).attr("id").replace(/d/,""));var id=disease[name][1][Math.floor(Math.random()*disease[name][1].length)];$.post(url,{mode:2,id:id},function(data){loading.uninstall();if(data==""){bug.lightbox("Incorrect ID")}else{data=data.replace("@","");try{var json=eval("["+data+"]")}catch(err){console.log(data);if(mcb.GET("lang")=="fr")bug.lightbox("Oops! Pas de connexion.<br> Etes-vous connecté à Internet?");else bug.lightbox("Oops! We couldnt connect to the server.<br>We suspect you are not connected to the internet!");return}$("#gameMenu").hide();json=json[0].level;f.roundID=json.attributes.id;for(var i=0;i<json.sequence.length;i++){json.sequence[i]=json.sequence[i].replace(/-/g,"_").toUpperCase()}f.collectedSeq=json.sequence;if(window.DEBUG)console.log(json.tree);var tree=newick.parse(json.tree);f.buildGameTree(tree);f.start(doc,win)}}).error(function(){loading.uninstall();if(mcb.GET("lang")=="fr")bug.lightbox("Oops! Pas de connexion.<br> Etes-vous connecté à Internet?");else bug.lightbox("Oops! We couldnt connect to the server.<br>We suspect you are not connected to the internet!")})})},config:function(){var a=document.getElementById("gameMenu");var b=function(){if(window.innerWidth<a.offsetWidth){a.style.left="0px"}else{a.style.left=(window.innerWidth-a.offsetWidth)/2+"px"}};b();window.foot();$(window).resize(function(){b()})},configMobile:function(){$("#gameMenu").css({background:"url()",left:"0px"});$("#footer").css("left","2em")}};window.gameMenuArray=[["en:Random","fr:AlÃ©atoire",gMenu.random],["en:Level ID","fr:ID Niveau",gMenu.level],["en:Disease","fr:Maladie",gMenu.disease]];var gameMenuArray=window.gameMenuArray;var lang=mcb.GET("lang");var data="<div id='gameMenu'><div id='gameType'>";for(var i=0;i<gameMenuArray.length;i++){for(var j=0;j<gameMenuArray[i].length-1;j++){if(gameMenuArray[i][j].search(lang)>-1){if(i==0)data+="<div class='gameTab' style='z-Index:171;'>"+gameMenuArray[i][j].replace(lang+":","")+"</div>";else data+="<div class='gameTab'>"+gameMenuArray[i][j].replace(lang+":","")+"</div>";break}}}data+="</div><div id='gameContent'></div>";$("#sandbox").append(data);if(common.checkDevice()!="other"&&common.checkDevice()!="ipad")gMenu.configMobile();else gMenu.config();gMenu.random();var gameSwitch=function(){var a=$(this).html();for(var b=0;b<gameMenuArray.length;b++){for(var c=0;c<gameMenuArray[b].length-1;c++){if(gameMenuArray[b][c].search(a)>-1){$("#gameContent").html("");try{gameMenuArray[b][gameMenuArray[b].length-1]()}catch(d){console.log("Error loading gamemMenu of "+a+" > "+d)}break}}}$(".gameTab").each(function(){$(this).css("zIndex","")});$(this).css("zIndex","171")};$(".gameTab").bind("click",gameSwitch)};g.prototype.start=function(a,b){var c=this;this.lbContent(function(){var d=document.getElementById("lbContent");d.style.position="absolute";d.style.top=window.innerHeight*.4+"px";d.style.left=window.innerWidth*.45+"px";var e=function(g){d.innerHTML=g;d.style.fontSize="70px";$("#lbContent").addClass("startSplash");if(g>0)window.setTimeout(function(){e(--g)},1100);else{c.killLightbox();gameIDE.renderEngine(a,b)}};e(3)})};g.prototype.enableTree=function(){var a=this,b=this.gs;$("#sandbox").append("<label id='treeButton'>Show Tree</label><div id='treeGroup' style='display:none;'><div id='treeBG'></div><div id='tree'></div></div>");$("#treeButton").css("top",b.yPx*b.yMargin+(b.y+1.3)*b.yPx);$("#treeButton").css("left",b.xPx*b.xMargin);$("#treeButton").css("height","1em");$("#treeButton").css("padding","1px 1px 1px 1px");if(common.checkDevice()=="other"){$("#treeButton").css("width","4.8em")}else{$("#treeButton").css("width","6em")}$("#treeButton").css("backgroundColor","#FFFFFF");$("#treeButton").css("color","black");$("#tree").css("top",b.yMargin*b.yPx);$("#tree").css("left",b.xMargin*b.xPx);$("#tree").css("height",(b.y+1)*b.yPx+5);$("#tree").css("width",b.x*b.xPx+5);$("#treeBG").css("top",b.yMargin*b.yPx);$("#treeBG").css("left",b.xMargin*b.xPx);$("#treeBG").css("height",(b.y+1)*b.yPx+5);$("#treeBG").css("width",b.x*b.xPx+5);$("#treeButton").click(function(){if($("#treeButton").html()=="Show Tree"){a.buildTree();$("#treeGroup").show();$("#treeButton").html("Hide Tree")}else{$("#treeGroup").hide();$("#treeButton").html("Show Tree")}})};g.prototype.buildTree=function(){$("#tree").html("");var a=this.gs,b=this;var c=function(d,e,g){var h=0,i=a.xMargin*a.xPx+a.xPx*g,j=0,k=true,l;if(d[e].child==0){if(d[e].node1>d[e].node2)j=d[e].node2+(d[e].node1-d[e].node2)/2;else j=d[e].node1+(d[e].node2-d[e].node1)/2;k=false}else if(d[e].child==1){j=c(d,d[e].node2,g+3);if(j>d[e].node1)h=d[e].node1+(j-d[e].node1)/2;else h=j+(d[e].node1-j)/2;j=h}else if(d[e].child==2){var m=c(d,d[e].node1,g+3);var n=c(d,d[e].node2,g+3);if(m>n)j=n+(m-n)/2;else j=m+(n-m)/2}if(window.DEBUG)console.log("@build treeChild> "+j);h=(Math.ceil(j)-1.29)*a.yPx+a.yPx*a.yMargin;$("#tree").append("<div class='treeChild' id='child"+e+"'style='top:"+h+"px;left:"+i+"px'></div>");$("#child"+e).mouseover(function(){b.buildAncester(a.xPx,a.yPx,a,d[e].ancester);$(this).removeClass("treeChild");$(this).addClass("onTreeChild");$("#treeAncester").show("slow");$(this).mouseleave(function(){$("#treeAncester").hide("slow");$(this).removeClass("onTreeChild");$(this).addClass("treeChild");$(this).unbind("mouseleave")})});if(k){if(d[e].child==2){l=b.createDiagonal(h,i,parseInt($("#child"+d[e].node1).css("top")),parseInt($("#child"+d[e].node1).css("left")));document.getElementById("tree").appendChild(l)}l=b.createDiagonal(h,i,parseInt($("#child"+d[e].node2).css("top")),parseInt($("#child"+d[e].node2).css("left")));document.getElementById("tree").appendChild(l);if(d[e].child==1){if(window.DEBUG)console.log("MINOR BUG - FIX WHEN HAVE TIME");animate.buildAnimal((g+1.5)*a.xPx+a.xMargin*a.xPx,(d[e].node1+.3)*a.yPx,d[e].p1,"tree");l=b.createDiagonal(h,i,(d[e].node1+.5)*a.yPx,(g+1.5)*a.xPx+a.xMargin*a.xPx);document.getElementById("tree").appendChild(l)}}else{animate.buildAnimal((g+1.5)*a.xPx+a.xMargin*a.xPx,(d[e].node1+.3)*a.yPx,d[e].p1,"tree");l=b.createDiagonal(h,i,(d[e].node1+.5)*a.yPx,(g+1.5)*a.xPx+a.xMargin*a.xPx);document.getElementById("tree").appendChild(l);animate.buildAnimal((g+1.5)*a.xPx+a.xMargin*a.xPx,(d[e].node2+.3)*a.yPx,d[e].p2,"tree");l=b.createDiagonal(h,i,(d[e].node2+.5)*a.yPx,(g+1.5)*a.xPx+a.xMargin*a.xPx);document.getElementById("tree").appendChild(l)}return Math.ceil(j)};c(this.tree,this.stage,0)};g.prototype.buildAncester=function(a,b,c,d){if(window.option==true){if(document.getElementById("compactTreeAncester")==undefined){var e=document.createElement("div");e.id="compactTreeAncester";e.className="ancestor";e.style.display="none";document.getElementById("sandbox").appendChild(e)}}else{if(document.getElementById("treeAncester")==undefined){var e=document.createElement("div");e.id="treeAncester";e.className="treeAncester";e.style.display="none";e.style.width=c.y*a+"px";e.style.height=b+4+"px";document.getElementById("tree").appendChild(e)}}var f="";var g=function(a){if(a=="A")return"#71B2E2";else if(a=="G")return"#9932CC";else if(a=="C")return"#008000";else if(a=="T")return"#FFA500";else return""};for(var h=0;h<d.length;h++){if(window.option==true){if(common.checkDevice()=="other")var i=a*c.yMargin+a*c.y+4;else var i=a*c.yMargin+a*c.y+4-c.xPx/2;var j=b*c.xMargin+b*h+2;f+="<div class='ancestorSequence' style='height:"+(a-2)/2+"px;width:"+(b-2)+"px;left:"+j+"px;top:"+i+"px;background-color:"+g(d[h])+"'></div>"}else{var i=a*c.yMargin+a*(c.y-1.15)+4;if(common.checkDevice()!="other"&&common.checkDevice()!="ipad")var j=c.xPx*c.xMargin+c.xPx*(h-.5);else var j=c.xPx*c.xMargin+c.xPx*(h-1.15);f+="<div class='treeAncestorSequence' style='height:"+(a-2)/2+"px;width:"+(b-2)+"px;left:"+j+"px;top:"+i+"px;background-color:"+g(d[h])+"'></div>"}}if(window.option==true){$("#compactTreeAncester").html(f)}else{$("#treeAncester").html(f)}};g.prototype.createAngle=function(a,b,c,d){a=parseInt(a);b=parseInt(b);c=parseInt(c);d=parseInt(d);var e=document.createElement("div");var f=document.createElement("div");e.className="angle";f.className="angle";if(c>a){e.style.top=a+"px";e.style.left=b+"px";e.style.height=c-a+"px";e.style.borderLeft="solid 2px #FFF";f.style.top=c+"px";f.style.left=b+"px";f.style.width=d-b+"px";f.style.height="2px";f.style.backgroundColor="#FFFFFF"}else{e.style.top=c+"px";e.style.left=b+"px";e.style.height=a-c+"px";e.style.borderLeft="solid 2px #FFF";f.style.top=c+"px";f.style.left=b+"px";f.style.width=d-b+"px";f.style.height="2px";f.style.backgroundColor="#FFFFFF"}return{vertical:e,horizontal:f}};g.prototype.createDiagonal=function(a,b,c,d){if(window.DEBUG)console.log("@create Diag > "+b+" <> "+a+" <> "+d+" <> "+c);a=parseInt(a);b=parseInt(b);c=parseInt(c);d=parseInt(d);var e=document.createElement("div");e.className="line";var f=Math.sqrt((b-d)*(b-d)+(a-c)*(a-c));e.style.width=f+"px";var g=Math.atan((c-a)/(d-b));e.style.top=a+.5*f*Math.sin(g)+5+"px";e.style.left=b-.5*f*(1-Math.cos(g))+2+"px";e.style.MozTransform=e.style.WebkitTransform=e.style.OTransform="rotate("+g+"rad)";return e};g.prototype.updateTree=function(a,b){this.tree=a;this.stage=b};g.prototype.cssScore=function(){var a=this.gs;$("#score").css("top",(a.y+.7)*a.yPx+a.yPx*a.yMargin);if(common.checkDevice()=="other"){$("#score").css("left",a.xPx*a.xMargin+(a.x-4.5)*a.xPx)}else{$("#score").css("left",a.xPx*a.xMargin+(a.x-5)*a.xPx)}if(1024>window.innerWidth){$("#score").css({"font-size":".75em",left:a.xPx*a.xMargin+(a.x-4.5)*a.xPx})}};g.prototype.timer=function(){var a=document,b=window,c=a.createElement("div"),d=this.gs;c.id="game-clock";c.style.top=(d.y+.7)*d.yPx+d.yPx*d.yMargin+"px";c.style.left=d.xPx*d.xMargin+(d.x-2)*d.xPx+"px";a.getElementById("sandbox").appendChild(c);$("#game-clock").append("<div id='game-timer'>150s</div><div id='game-star'></div>");$("#game-star").css({height:d.yPx,width:d.xPx});$("#game-star").html("<img src='../img/star.png' class='game-star' style='display:none;'/><img src='../img/cycle.png' class='game-cycle' style='opacity:0.7'/>");$("#game-star-layer").css({height:d.yPx,width:d.xPx});$(".game-cycle").mouseover(function(){$(this).css("opacity","1");$(".game-cycle").mouseout(function(){$(this).css("opacity","0.7");$(".game-cycle").unbind("mouseout")})});var e=document.getElementById("endGameMenu");var f=function(){try{var a=parseInt($("#game-timer").html().replace(/s/,""))}catch(b){animate.killMultiSelect();return}if(document.getElementById("endGameMenu")!=undefined)return;if(document.getElementById("game-timer")!=undefined&&0<a){try{if($("#tutorialContent").hasClass("tutorial-enabled")==false)a--}catch(b){console.log("error @ game-timer > "+b);a--}$("#game-timer").html(a+"s");window.setTimeout(function(){f()},1e3)}if(a==0){animate.killMultiSelect();animate.endGameMenu(1)}};f()};g.prototype.buildClock=function(){var a=document,b=window,c=document.createElement("div"),d=this.gs;c.id="clock";c.style.top=(d.y+.7)*d.yPx+d.yPx*d.yMargin+"px";c.style.left=d.xPx*d.xMargin+(d.x-2)*d.xPx+"px";a.getElementById("sandbox").appendChild(c);$("#clock").append("<div id='clockbg'><div id='clockbgTopLeft'></div><div id='clockbgTopRight'></div><div id='clockbgBottomLeft'></div><div id='clockbgBottomRight'></div></div><div id='rotate'><div id='pie'></div><div id='pieCenter'></div></div>");var e=new Date;var f={set:setInterval(function(){if(this.x==undefined)this.x=0;else if(this.x==361)this.x=0;var a="rotate("+this.x+"deg)";$("#rotate").css({"-moz-transform":a,"-webkit-transform":a});this.x++},0),init:function(){f.set}};f.init();if(common.checkDevice()=="other")$("#pieCenter").click(function(){fitch.reset()});else $("#pieCenter").touchstart(function(){fitch.reset()})};g.prototype.init=function(a){this.gs=a;if(!window.option)this.enableTree();this.cssScore()};g.prototype.testFontSize=function(){if(this.fontSize!=undefined)return this.fontSize;if(document.getElementById("testFontSize")==undefined){var a=document;var b=a.createElement("div");b.id="testFontSize";b.style.display="none";b.style.fontSize="1em";a.body.appendChild(b);a.getElementById("testFontSize").appendChild(a.createTextNode("M"))}this.fontSize=document.getElementById("testFontSize").offsetHeight;return this.fontSize};g.prototype.buildCompactTreeNode=function(a,b,c){if(b>a){var d=a;a=b;b=d}var e=a+(a-b)/2,f=this.gs,g;if(c!=0)e=a+(b-a)/2;if(common.checkDevice()=="ipad")var h=f.yPx*1+f.yPx*e;else var h=f.yPx*1.5+f.yPx*e;if(c!=0)h+=f.yPx;var i=(f.xMargin-1.2)*f.xPx+window.optionScale*c/5*-1;var j=this.tree[this.stage].score;if(j>=0)j="+"+j;else j="<span style='color:red'>"+j+"</span>";$("#compactTree").append("<div class='compactTreeNodeFake' id='ctnf"+this.stage+"'style='top:"+h+"px;left:"+i+"px'></div>"+"<div class='compactTreeNode' id='ctn"+this.stage+"'style='top:"+(h-f.xPx/6)+"px;left:"+(i-f.yPx/6)+"px;height:"+f.xPx/3+"px;width:"+f.yPx/3+"px'></div>"+"<div class='compactTreeNodeScore' id='ctn-score-"+this.stage+"'style='top:"+(h-f.xPx/2)+"px;left:"+(i-f.yPx/1.7)+"px;height:"+f.xPx/3+"px;width:"+f.yPx/1.5+"px;font-size:"+f.xPx/3.4+"px'>"+j+"</div>");var k=this;if(common.checkDevice()=="other"){$("#ctn"+this.stage).mouseover(function(){k.buildAncester(k.gs.xPx,k.gs.yPx,k.gs,k.tree[this.id.replace(/ctn/,"")].ancester);$("#ancestor").hide();$(this).addClass("onTreeNode");$("#compactTreeAncester").show("fast");$(this).mouseleave(function(){$("#compactTreeAncester").hide();$("#ancestor").show("fast");$(this).unbind("mouseleave");$(this).removeClass("onTreeNode")})})}else{$("#ctn"+this.stage).touchstart(function(){k.buildAncester(k.gs.xPx,k.gs.yPx,k.gs,k.tree[this.id.replace(/ctn/,"")].ancester);$("#ancestor").hide();$(this).addClass("onTreeNode");$("#compactTreeAncester").show("fast");$(this).touchend(function(){$("#compactTreeAncester").hide();$("#ancestor").show("fast");$(this).removeClass("onTreeNode");$(this).unbind("mouseleave")})})}};g.prototype.distLookUp=function(a){var b=this.tree;if(b[a].child==0){if(b[a].node1>b[a].node2)return{score:b[a].node2+(b[a].node1-b[a].node2)/2,seed:1};else return{score:b[a].node1+(b[a].node2-b[a].node1)/2,seed:1}}else if(b[a].child==1){tmp=this.distLookUp(b[a].node2);if(tmp.score>b[a].node1)return{score:b[a].node1+(tmp.score-b[a].node1)/2,seed:tmp.seed+1};else return{score:tmp.score+(b[a].node1-tmp.score)/2,seed:tmp.seed+1}}else if(b[a].child==2){var c=this.distLookUp(b[a].node1);var d=this.distLookUp(b[a].node2);if(c.score>d.score)return{score:d.score+(c.score-d.score)/2,seed:c.seed>d.seed?c.seed+1:d.seed+1};else return{score:c.score+(d.score-c.score)/2,seed:c.seed>d.seed?c.seed+1:d.seed+1}}};g.prototype.compactNodeLost=true;g.prototype.buildCompactTree=function(){if(document.getElementById("compactTree")==undefined){$("#sandbox").append("<div id='compactTree'></div>")}var a=this.stage,b=this.tree[a],c,d,e,f,g,h,i=this.gs;if(a==0){if(this.compactNodeLost==true)this.compactNodeLost=false;else{return}}var j=i.yPx/2;if(common.checkDevice()=="ipad")j=0;if(b.child==0){this.buildCompactTreeNode(b.node1,b.node2,0);x=parseInt($("#ctnf"+a).css("left"));y=parseInt($("#ctnf"+a).css("top"))+1;d=i.xPx*(i.xMargin-i.xMargin*.7);f=i.yPx*i.yMargin+i.yPx*b.node1+j;h=i.yPx*i.yMargin+i.yPx*(b.node1-.3)+j;this.buildAnimal(d+2,h,b.p1,"compact");c=this.createAngle(y,x,f,d);document.getElementById("compactTree").appendChild(c.vertical);document.getElementById("compactTree").appendChild(c.horizontal);f=i.yPx*i.yMargin+i.yPx*b.node2+j;h=i.yPx*i.yMargin+i.yPx*(b.node2-.3)+j;this.buildAnimal(d+2,h,b.p2,"compact");c=this.createAngle(y,x,f,d);document.getElementById("compactTree").appendChild(c.vertical);document.getElementById("compactTree").appendChild(c.horizontal)}else if(b.child==1){var k=this.distLookUp(b.node2);this.buildCompactTreeNode(b.node1,k.score,k.seed);f=parseInt($("#ctnf"+b.node1).css("top"));d=parseInt($("#ctnf"+b.node1).css("left"));x=parseInt($("#ctnf"+a).css("left"));y=parseInt($("#ctnf"+a).css("top"))+1;if(isNaN(f)&&isNaN(g)){f=i.yPx*i.yMargin+i.yPx*b.node1+j;h=i.yPx*i.yMargin+i.yPx*(b.node1-.3)+j;d=i.xPx*(i.xMargin-i.xMargin*.7);this.buildAnimal(d+2,h,b.p1,"compact")}if(window.DEBUG){console.log("");console.log("*****ERROR DEBUG *****");console.log("tree child @ 1");console.log("y1 > "+f);console.log("x1 > "+d);console.log("nodes > "+b.node1+"<>"+b.node2);console.log("*****END OF DEBUG *****");console.log("")}c=this.createAngle(y,x,f,d);document.getElementById("compactTree").appendChild(c.vertical);document.getElementById("compactTree").appendChild(c.horizontal);g=parseInt($("#ctnf"+b.node2).css("top"));e=parseInt($("#ctnf"+b.node2).css("left"));c=this.createAngle(y,x,g,e);document.getElementById("compactTree").appendChild(c.vertical);document.getElementById("compactTree").appendChild(c.horizontal)}else if(b.child==2){var l=this.distLookUp(b.node1);var m=this.distLookUp(b.node2);this.buildCompactTreeNode(l.score,m.score,l.seed>m.seed?l.seed:m.seed);f=parseInt($("#ctnf"+b.node1).css("top"));g=parseInt($("#ctnf"+b.node2).css("top"));d=parseInt($("#ctnf"+b.node1).css("left"));e=parseInt($("#ctnf"+b.node2).css("left"));x=parseInt($("#ctnf"+a).css("left"));y=parseInt($("#ctnf"+a).css("top"))+1;c=this.createAngle(y,x,f,d);document.getElementById("compactTree").appendChild(c.vertical);document.getElementById("compactTree").appendChild(c.horizontal);c=this.createAngle(y,x,g,e);document.getElementById("compactTree").appendChild(c.vertical);document.getElementById("compactTree").appendChild(c.horizontal)}};g.prototype.buildAnimal=function(a,b,c,d){im=images.get(c);im.style.top=b+"px";im.style.left=a+"px";im.style.height=this.gs.yPx*.8+"px";im.style.width=this.gs.xPx*.8+"px";im.style.position="absolute";if(d=="compact"){document.getElementById("compactTree").appendChild(im)}else{document.getElementById("tree").appendChild(im)}};g.prototype.stageAnimation=function(a){this.stage=a;var b=this.gs;var c=b.yMargin*b.yPx+5*b.yPx;var d=b.xMargin*b.xPx+5*b.xPx;var e=b.yMargin*b.yPx+3*b.yPx;var f=b.xMargin*b.xPx+7*b.xPx;var g="";if(document.getElementById("stage-animation")==undefined){g+="<div id='stage-animation' style='color:#980000;font-size:6em;top:"+e+"px;left:"+f+"px;position:absolute;z-index:210;width:6em;text-shadow:0px 0px 50px #000'>STAGE "+a+"</div>";$("#sandbox").append(g)}else{$("#stage-animation").html("STAGE "+a)}window.setTimeout(function(){$(".bgGrid").each(function(){$(this).css("display","none")});$("#grids").css("position","absolute");$("#grids").css("top","-1em");$("#grids").css("left","1em");$("#stage-animation").css("display","")},0);window.setTimeout(function(){window.setTimeout(function(){$("#stage-animation").css("display","none")},800)},100);window.setTimeout(function(){$(".bgGrid").each(function(){$(this).css("display","")});$("#grids").css("position","");$("#grids").css("top","");$("#grids").css("left","")},200)};g.prototype.tutorial=function(){var a=document,b=window,c=this.gs;if(a.getElementById("tutorialContent")==undefined){var d=a.createElement("div");d.id="tutorialContent";a.body.appendChild(d);var d=a.createElement("div");d.id="tutorialContent-bg";a.body.appendChild(d);$("#tutorialContent").css({left:"0px",top:"0px",height:b.innerHeight+"px",width:b.innerWidth+"px",display:"none",zIndex:"300",position:"absolute"});$("#tutorialContent-bg").css({backgroundColor:"#000000",opacity:"0.55",left:"0px",top:"0px",height:b.innerHeight+"px",width:b.innerWidth+"px",display:"none",zIndex:"299",position:"absolute"})}var e={begin:function(){var a;if(mcb.GET("lang")=="fr")a="z";else a="";$("#tutorialContent").append("<a id='tutorial-continue' href='#'>Continue"+a+"</a><div id='tutorial-content-begin'><div class='arrow-left arrow-color'></div><div class='arrow-mid arrow-color'></div><div class='arrow-right arrow-color'></div></div>");$("#tutorialContent").addClass("tutorial-enabled");$("#tutorial-content-begin").css({position:"relative",top:c.yMargin*c.yPx+2/3*c.y*c.xPx,left:c.xMargin*c.xPx+window.optionScale,width:c.x*c.xPx,height:"5em"});$(".arrow-left").css({width:0,height:0,"border-top":c.xPx+"px solid transparent","border-bottom":c.xPx+"px solid transparent","border-right":c.xPx+"px solid red",position:"relative","float":"left"});$(".arrow-right").css({width:0,height:0,"border-top":c.xPx+"px solid transparent","border-bottom":c.xPx+"px solid transparent","border-left":c.xPx+"px solid red",position:"relative",left:"93.5%"});$(".arrow-mid").css({width:"90%",height:c.xPx,position:"relative",backgroundColor:"red","text-align":"center","float":"left",top:c.xPx/2});$("#tutorial-continue").css({position:"absolute",top:c.yMargin*c.yPx+1/3*c.y*c.xPx,height:"10px auto",left:window.innerWidth*.45,fontSize:"1.5em",left:"43%",padding:"0.5em",backgroundColor:"#71B2E2",zIndex:"301","border-radius":"0.5em","-webkit-border-radius":"0.5em","-moz-border-raidus":"0.5em","-khtml-border-radius":"0.5em"});var a;if(mcb.GET("lang")=="fr")a="<div>Déplacez les carrés à gauche et à droite. Essayez de faire correspondre les couleurs dans une colonne tout en évitant les lacunes.<br>"+(common.checkDevice()=="ipad"?"Utilisez deux doigts":"Double-cliquez")+" pour cr&#233;er une bo&#238;te pour s&#233;lectionner plusieurs blocs &#224; la fois.</div>";else a="<div>Move the squares left and right. Try to match colours vertically while avoiding gaps.<br>"+(common.checkDevice()=="ipad"?"Use two fingers":"Double-click")+" to create a selection box for multiple blocks.</div>";$(".arrow-mid").html(a);$(".arrow-mid div").css({top:c.xPx/2/3,position:"relative"});if(window.innerWidth<1024){$(".arrow-mid div").css({"font-size":".55em",top:"-.1em"})}if(common.checkDevice()=="ipad"){$(".arrow-mid div").css({top:0,"font-size":".9em"})}$("#tutorialContent").show();$("#tutorialContent-bg").show();$("#tutorial-continue").click(function(){$("#tutorial-content-begin").remove();$("#tutorial-continue").unbind("click");e.score()})},score:function(){$("#tutorialContent").append("<div id='tutorial-score-circle'></div><div id='tutorial-score-content'></div><div id='tutorial-par-circle'></div><div id='tutorial-par-content'></div>");$("#tutorial-score-circle").css({position:"relative",height:c.xPx*4,width:c.xPx*4,"border-radius":c.xPx*2,"-moz-border-radius":c.xPx*2,"-webkit-border-radius":c.xPx*2,"-khtml-border-radius":c.xPx*2,backgroundColor:"transparent","border-style":"solid","border-color":"#FFFFFF",top:parseInt($(".compactTreeNode").css("top").replace(/px/,""))-c.xPx*1.3,left:parseInt($(".compactTreeNode").css("left").replace(/px/,""))+window.optionScale-c.xPx*2});$("#tutorial-par-circle").css({position:"relative",height:c.xPx*5.5,width:c.xPx*5.5,"border-radius":c.xPx*3,"-moz-border-radius":c.xPx*3,"-webkit-border-radius":c.xPx*3,"-khtml-border-radius":c.xPx*3,backgroundColor:"transparent","border-style":"solid","border-color":"#FFFFFF",top:c.y/2*c.yPx+1*c.xPx,left:parseInt($("#game-clock").css("left").replace(/px/,""))-window.optionScale*.13});var a;if(mcb.GET("lang")=="fr")a="Regardez ici pour voir comment vous faites. Les scores rouges signifie que vous pouvez améliorer cette branche!";else a="Check here to see how you're doing. Red scores mean that you can improve that branch!";$("#tutorial-score-content").html(a);$("#tutorial-score-content").css({top:-c.xPx,left:c.xMargin*c.xPx+5.5*c.xPx,"border-radius":"0.5em","-webkit-border-radius":"0.5em","-moz-border-raidus":"0.5em","-khtml-border-radius":"0.5em",padding:"1em",position:"relative",height:c.xPx+"px auto",width:(c.x-2)*c.xPx,backgroundColor:"white",color:"black"});$("#tutorial-par-content").css({"border-radius":"0.5em","-webkit-border-radius":"0.5em","-moz-border-raidus":"0.5em","-khtml-border-radius":"0.5em",padding:"1em",top:2*c.xPx,left:c.xMargin*c.xPx+2*c.xPx,position:"relative",height:c.xPx+"px auto",width:(c.x-6)*c.xPx,backgroundColor:"white",color:"black"});if(mcb.GET("lang")=="fr")a="Regardez ici pour le score 'par'. C'est le score minimum dont vous avez besoin pour passer à l'étage suivante.<br> Cliquez sur l'étoile qui saute ici quand vous êtes prêt!";else a="Look here for the par score. That is the minimum score you need to move to the next stage.<br> Click the jumping star here when you are ready!";$("#tutorial-par-content").html(a);$("#tutorialContent").show();$("#tutorialContent-bg").show();if(mcb.GET("lang")=="fr")a="Je Suis Prêt!";else a="I'm Ready!";$("#tutorial-continue").html(a);$("#tutorial-continue").click(function(){$("#tutorialContent").hide();$("#tutorialContent-bg").hide();$("#tutorialContent").removeClass("tutorial-enabled");$("#tutorialContent").html("");if(window.guest!="guest"&&window.guest!="undefined"&&window.guest!=undefined)mcb.cookie.create("phylo-tutorial-"+window.guest,"complete",365)})}};e.begin()};g.prototype.killMultiSelect=function(){var a=document;try{$(a).unbind("mousedown");$(a).unbind("mouseup");if(window.selectTracking)$(a).unbind("click")}catch(b){console.log("killMultiSelect > "+b)}try{$("#tutorialContent").remove();$("#tutorialContent-bg").remove()}catch(b){}};g.prototype.multiSelect=function(a,b,c,d){this.Grid=b;this.tree=c;this.gData=d;window.selectTracking=false;this.domCache=a;var e=document,f=window;this.c=0;var g=this;var h=0;var i;window.blockMultiSelect=false;var j=window.blockMultiSelect;if(common.checkDevice()=="other"){$(e).dblclick(function(a){g.onSelect(e,f,a)})}else{this.doubleTab(e,f)}};g.prototype.doubleTab=function(a,b){var c=this.gs;var d=$("#sandbox").css("left");d=parseInt(d);var e=a.createElement("div");e.id="doubleTabX";e.className="mouseCircle";a.getElementById("sandbox").appendChild(e);$("#doubleTabX").css({width:c.xPx*2,height:c.xPx*2,"border-radius":c.xPx,"-moz-border-radius":c.xPx,"-webkit-border-radius":c.xPx,"-khtml-border-radius":c.xPx});var e=a.createElement("div");e.id="doubleTabY";e.className="mouseCircle";a.getElementById("sandbox").appendChild(e);$("#doubleTabY").css({width:c.xPx*2,height:c.xPx*2,"border-radius":c.xPx,"-moz-border-radius":c.xPx,"-webkit-border-radius":c.xPx,"-khtml-border-radius":c.xPx});var e=a.createElement("div");e.id="multiSelectSquare";a.getElementById("sandbox").appendChild(e);$("#multiSelectSquare").css({position:"absolute","border-style":"solid",opacity:"0.6","background-color":"#800000","border-color":"red","border-width":"0.3em",zIndex:"120"});var e=a.createElement("div");e.id="multiSelectBox";a.getElementById("sandbox").appendChild(e);$("#multiSelectBox").css({position:"absolute","border-style":"solid",opacity:"0.6","background-color":"#800000","border-color":"red","border-width":"0.3em",zIndex:"120",display:"none"});$("#doubleTabX").hide();$("#doubleTabY").hide();$("#multiSelectSquare").hide();a.ontouchstart=function(a){if(a.touches.length==2){a.preventDefault();$("#doubleTabX").show();$("#doubleTabY").show();$("#doubleTabX").css({top:a.touches[0].pageY,left:a.touches[0].pageX-(d+c.xPx)});$("#doubleTabY").css({top:a.touches[1].pageY,left:a.touches[1].pageX-(d+c.xPx)});i.style.display="";$("#multiSelectBox").hide();m.onMultiSelectTouchMove(a,h,d)}else{if(a.touches.length==1){var b={top:parseInt(g.style.top.replace(/px/,"")),left:parseInt(g.style.left.replace(/px/,"")),width:parseInt(g.style.width.replace(/px/,"")),height:parseInt(g.style.height.replace(/px/,""))};var e={top:parseInt(h.style.top.replace(/px/,"")),left:parseInt(h.style.left.replace(/px/,"")),width:parseInt(h.style.width.replace(/px/,"")),height:parseInt(h.style.height.replace(/px/,""))};var f=a.touches[0];if(b.left<f.pageX-d&&f.pageX-d<b.left+b.width&&b.top<f.pageY&&f.pageY<b.top+b.height||e.left<f.pageX-d&&f.pageX-d<e.left+e.width&&e.top<f.pageY&&f.pageY<e.top+e.height){}else{$("#doubleTabX").hide();$("#doubleTabY").hide();i.style.display="none"}}}};var f=[0,0];var g=a.getElementById("doubleTabX");var h=a.getElementById("doubleTabY");var i=a.getElementById("multiSelectSquare");var j=a.getElementById("multiSelectBox");var k=0,l=0;var m=this;g.ontouchmove=function(a){a.preventDefault();if(f[0]==0||f[0]!=2){f[0]=1;k=0;m.onMultiSelectTouchMove(a,h,d)}else{f[1]=1;k=1}var b=a.touches[k];$("#doubleTabX").css({top:b.pageY-c.xPx,left:b.pageX-(d+c.xPx)})};h.ontouchmove=function(a){a.preventDefault();if(f[0]==0||f[0]!=1){f[0]=2;l=0;m.onMultiSelectTouchMove(a,g,d)}else{f[1]=2;l=1}var b=a.touches[l];$("#doubleTabY").css({top:b.pageY-c.xPx,left:b.pageX-(d+c.xPx)})};g.ontouchend=function(a){a.preventDefault();f[k]=0};h.ontouchend=function(a){a.preventDefault();f[l]=0};var n="";i.ontouchstart=function(c){c.preventDefault();i.style.display="none";g.style.display="none";h.style.display="none";n=m.onMultiSelectTouchCapture(a,b);if(n.selected==true){var d=n.box;j.style.left=d.left+"px";j.style.top=d.top+"px";j.style.height=d.bottom-d.top+"px";j.style.width=d.right-d.left+"px";j.style.display=""}else j.style.display="none"};var o=window.optionScale;m.registered="";j.ontouchmove=function(c){c.preventDefault();m.multiSelectMove(n.box,n.captured,a,b,c.touches[0],j.style,o)};j.ontouchend=function(a){m.registered="";a.preventDefault();j.style.display="none";m.multiSelectSnap(n.box,n.captured);m.tree=fitch.algo(m.Grid,m.gs,m.gData,m.tree,m.stage)}};g.prototype.onMultiSelectTouchCapture=function(a,b){function h(a,b){if(f(a,b)){var c=new RegExp("(\\s|^)"+b+"(\\s|$)");a.className=$.trim(a.className.replace(c," "))}}function g(a,b){if(!f(a,b))a.className+=" "+b}function f(a,b){return a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))}var c=this.gs;var d={top:parseInt($("#multiSelectSquare").css("top")),left:parseInt($("#multiSelectSquare").css("left")),height:parseInt($("#multiSelectSquare").css("height")),width:parseInt($("#multiSelectSquare").css("width"))};b.selectTracking=false;var e=b.selectTracking;var i=this.domCache;var j={left:"",right:"",top:"",bottom:""};var k=[];for(var l=0,m=i.length;l<m;l++){if(i[l]!=0){if(f(i[l].parentElement,"current")&&!f(i[l].parentElement,"new")){var n={left:parseInt(i[l].style.left.replace(/px/,"")),top:parseInt(i[l].style.top.replace(/px/,""))};if(d.left-c.xPx<n.left&&n.left<d.left+d.width&&d.top-c.xPx<n.top&&n.top<d.top+d.height){e=true;k.push(i[l]);if(j.left==""){j.left=n.left;j.right=n.left+c.xPx;j.top=n.top;j.bottom=n.top+c.xPx}if(n.left<j.left)j.left=n.left;if(j.right<n.left+c.xPx)j.right=n.left+c.xPx;if(n.top<j.top)j.top=n.top;if(j.bottom<n.top+c.xPx)j.bottom=n.top+c.xPx}}}}j.right=j.right-8;j.bottom=j.bottom-8;return{selected:e,box:j,captured:k}};g.prototype.onMultiSelectTouchMove=function(a,b,c){var d=a.touches[0];var e=parseInt(b.style.left.replace(/px/,""));var f=parseInt(b.style.top.replace(/px/,""));var g=this.gs;if(d.pageX-c>=e&&d.pageY>=f){$("#multiSelectSquare").css({top:f+g.xPx,left:e+g.xPx,height:d.pageY-f-g.xPx,width:d.pageX-c-e-g.xPx})}else if(d.pageY>=f&&d.pageX<e+c){$("#multiSelectSquare").css({top:f+g.xPx,left:d.pageX-c,height:d.pageY-f-g.xPx,width:e+c-d.pageX+g.xPx})}else if(d.pageY<f&&d.pageX<e+c){$("#multiSelectSquare").css({top:d.pageY,left:d.pageX-c,height:f-d.pageY+g.xPx-2,width:e+c-d.pageX+g.xPx-2})}else{$("#multiSelectSquare").css({top:d.pageY,left:e+g.xPx,height:f-d.pageY+g.xPx,width:d.pageX-c-e-g.xPx})}};g.prototype.onSelect=function(a,b,c){this.first=true;var d=this.first;this.registered="";var e=this.gs;if(a.getElementById("multiSelectCircleLock")==undefined){var f=a.createElement("div");f.id="multiSelectCircleLock";f.className="mouseCircle";a.getElementById("sandbox").appendChild(f);$("#multiSelectCircleLock").css({width:e.xPx*2,height:e.xPx*2,"border-radius":e.xPx,"-moz-border-radius":e.xPx,"-webkit-border-radius":e.xPx,"-khtml-border-radius":e.xPx,"z-index":110});var f=a.createElement("div");f.id="multiSelectCircleMove";f.className="mouseCircle";a.getElementById("sandbox").appendChild(f);$("#multiSelectCircleMove").css({width:e.xPx*2,height:e.xPx*2,"border-radius":e.xPx,"-moz-border-radius":e.xPx,"-webkit-border-radius":e.xPx,"-khtml-border-radius":e.xPx,"z-index":110});var f=a.createElement("div");f.id="multiSelectSquare";a.getElementById("sandbox").appendChild(f);$("#multiSelectSquare").css({position:"absolute","border-style":"solid",opacity:"0.6","background-color":"#800000","border-color":"red","border-width":"0.3em",zIndex:"119"});var f=a.createElement("div");f.id="multiSelectBox";a.getElementById("sandbox").appendChild(f);$("#multiSelectBox").css({position:"absolute","border-style":"solid",opacity:"0.6","background-color":"#800000","border-color":"red","border-width":"0.2em",zIndex:"110"})}var g=$("#sandbox").css("left");g=parseInt(g);if(isNaN(g))g=0;$("#multiSelectCircleLock").css({top:c.pageY-e.xPx*1.3,left:c.pageX-(g+e.xPx)});$("#multiSelectCircleMove").css({top:c.pageY-e.xPx*1.3,left:c.pageX-(g+e.xPx)});$("#multiSelectCircleLock").show();$("#multiSelectCircleMove").show();$("#multiSelectSquare").show();var h=c.pageX-g,i=c.pageY;$("#multiSelectSquare").css({top:i,left:h,height:0,width:0});$(a).mousemove(function(a){$("#multiSelectCircleMove").css({top:a.pageY-e.xPx*1.3,left:a.pageX-(g+e.xPx)});if(a.pageX-g>=h&&a.pageY>=i){$("#multiSelectSquare").css({top:i-e.xPx/5,left:h,height:a.pageY-i-e.xPx/3,width:a.pageX-g-h-e.xPx/5})}else if(a.pageY>=i&&a.pageX<h+g){$("#multiSelectSquare").css({top:i-e.xPx/5,left:a.pageX-g,height:a.pageY-i-e.xPx/3,width:h+g-a.pageX-e.xPx/8})}else if(a.pageY<i&&a.pageX<h+g){$("#multiSelectSquare").css({top:a.pageY-e.xPx/3,left:a.pageX-g,height:i-a.pageY,width:h+g-a.pageX-e.xPx/8})}else{$("#multiSelectSquare").css({top:a.pageY-e.xPx/3,left:h,height:i-a.pageY,width:a.pageX-g-h})}});var j=this;var k=function(c){b.setTimeout(function(){j.onSelectCapture(g,a,b)},0);$("#multiSelectCircleLock").hide();$("#multiSelectCircleMove").hide();$("#multiSelectSquare").hide();$(a).unbind("mousemove");$(a).unbind("mouseup",k)};$(a).unbind("mouseup",k).bind("mouseup",k)};g.prototype.onSelectCapture=function(a,b,c){function i(a,b){if(g(a,b)){var c=new RegExp("(\\s|^)"+b+"(\\s|$)");a.className=$.trim(a.className.replace(c," "))}}function h(a,b){if(!g(a,b))a.className+=" "+b}function g(a,b){return a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))}var d=this.gs;var e={top:parseInt($("#multiSelectSquare").css("top")),left:parseInt($("#multiSelectSquare").css("left")),height:parseInt($("#multiSelectSquare").css("height")),width:parseInt($("#multiSelectSquare").css("width"))};c.selectTracking=false;var f=c.selectTracking;var j=this.domCache;var k={left:"",right:"",top:"",bottom:""};var l=[];for(var m=0,n=j.length;m<n;m++){if(j[m]!=0){if(g(j[m].parentElement,"current")&&!g(j[m].parentElement,"new")){var o={left:parseInt(j[m].style.left.replace(/px/,"")),top:parseInt(j[m].style.top.replace(/px/,""))};if(e.left-d.xPx<o.left&&o.left<e.left+e.width&&e.top-d.xPx<o.top&&o.top<e.top+e.height){f=true;l.push(j[m]);if(k.left==""){k.left=o.left;k.right=o.left+d.xPx;k.top=o.top;k.bottom=o.top+d.xPx}if(o.left<k.left)k.left=o.left;if(k.right<o.left+d.xPx)k.right=o.left+d.xPx;if(o.top<k.top)k.top=o.top;if(k.bottom<o.top+d.xPx)k.bottom=o.top+d.xPx}}}}k.right=k.right-6;k.bottom=k.bottom-6;var p=this;var q=window.optionScale;if(f){$("#multiSelectBox").css({top:k.top,left:k.left,width:k.right-k.left,height:k.bottom-k.top,display:""});var r=function(a){if(window.DEBUG){console.log("***MultiSelect Hit Test***");console.log(k.left+" <> "+(a.pageX-q+d.xPx/6));console.log(k.top+" <> "+(a.pageY-d.xPx/3));console.log(a.pageX-q+" <> "+k.right);console.log(a.pageY-d.xPx/3+" <> "+k.bottom)}if(k.left<=a.pageX-q+d.xPx/6&&a.pageX-q<=k.right&&k.top<=a.pageY-d.xPx/3&&a.pageY-d.xPx/3<=k.bottom){var e=b.getElementById("multiSelectBox").style;$(this).mousemove(function(a){p.multiSelectMove(k,l,b,c,a,e,q)});$(this).mouseup(function(){$(this).unbind("mousemove");$(this).unbind("mouseup");$("#multiSelectBox").hide();$(b).unbind("mousedown",r);p.multiSelectSnap(k,l);l=[];p.tree=fitch.algo(p.Grid,d,p.gData,p.tree,p.stage)})}else{$("#multiSelectBox").hide();l=[];$(b).unbind("mousedown",r)}};$(b).bind("mousedown",r)}return};g.prototype.stage="";g.prototype.multiSelectSnap=function(a,b){var c=this.domCache;var d=this.gs;var e=this;var f=function(a){var b=0;for(var c=0;c<e.gData[a].length;c++){if(e.gData[a][c]!="_")b++}return b};var g=function(a){var a=parseInt(a);for(var b=0;b<e.Grid.length;b++){if(b*d.seqLen<=a&&a<b*d.seqLen+30){break}}return b};var h=d.xPx*d.xMargin;for(var i=0;i<e.Grid.length;i++){try{var j=f(i)}catch(k){return}var l=-1;for(var m=0;m<j;m++){var n=i*d.seqLen+m;var o=m*d.xPx+h;var p=(d.x-(j-m))*d.xPx+h;var q=parseInt(c[n].style.left);if(c[n]!=0){if(o<q&&q<p){var r=(q-h)%d.xPx;var s=Math.round((q-r-h)/d.xPx+1);if(r>d.xPx/2)s+=1;if(s<m)s+=1;if(s>m)s-=1}if(m*d.xPx+h>q){s=m}else if(q>(d.x-(j-m))*d.xPx+h){s=d.x-(j-m)}if(s==l)s+=1;else if(l>s)s=l+1;l=s;if(window.DEBUG)console.log("@snap > grid 2 > "+s);$("#"+n).animate({left:s*d.xPx+h+2},300);c.zIndex=100;var t=e.Grid[i].indexOf(n);e.Grid[i][t]="x";e.Grid[i][Math.round(s)]=Math.floor(n)}}}};g.prototype.multiSelectMove=function(a,b,c,d,e,f,g){var h=window.blockMultiSelect;h=true;var i=this.prevX;var j=parseInt(f.left.replace(/px/,""));var k=parseInt(f.width.replace(/px/,""));var l=this.domCache;var m=this.gs;var i=j;if(common.checkDevice()=="other"){var n=Math.round(e.pageX-g-j);var o="";if(this.registered==""){if(Math.abs(n-k)<0)o=n-k;else o=k-n-k;this.registered=o}else{o=this.registered}var p=e.pageX-g+o}else{var n=e.pageX-g-j;if(this.registered==""){this.registered=n}var p=e.pageX-g-this.registered}if(m.xPx*m.xMargin<p&&p+k<m.xPx*m.xMargin+m.xPx*m.x)f.left=p+"px";else return;for(var q=0,r=b.length;q<r;q++){if(p>i){var s=b[q].id;var t=function(){while(true){try{var a=parseInt(l[s].style.left.replace(/px/,""));var c=p-i;if(a+c+m.xPx>m.xPx*m.xMargin+m.xPx*m.x)return;l[s].style.left=a+c+"px";s++;if(b.indexOf(l[s])>0)return;if(a+c+m.xPx<parseInt(l[s].style.left.replace(/px/,"")))return}catch(d){return}}};t()}else{var s=b[q].id;var t=function(){while(true){try{var a=parseInt(l[s].style.left.replace(/px/,""));var c=p-i;if(a+c<m.xPx*m.xMargin)return;l[s].style.left=a+c+"px";s--;if(b.indexOf(l[s])>0)return;if(a+c>parseInt(l[s].style.left.replace(/px/,""))+m.xPx)return}catch(d){return}}};t()}}};var proto=g.prototype,attr=[["start",proto.start],["enableTree",proto.enableTree],["updateTree",proto.updateTree],["init",proto.init],["sleep",proto.sleep],["buildCompactTree",proto.buildCompactTree],["buildAnimal",proto.buildAnimal],["getSeq",proto.getSeq],["getGameTree",proto.getGameTree],["timer",proto.timer],["stageAnimation",proto.stageAnimation],["tutorial",proto.tutorial],["multiSelect",proto.multiSelect]];common.exportSingleton("animate",g,attr)})();(function(){function a(){}a.prototype.fn="";var b=a.prototype,c=[["fn",b.fn]];common.exportSingleton("tutorial",a,c)})()})();(function(){function a(){this.ty=new Image;this.ty.src="http://phylo.cs.mcgill.ca/img/thankyou.png";this.ty.id="thankyou"}a.prototype.get=function(a){if(a=="thankyou"){return this.ty}if(a=="hg19"||a=="GRCh37"){return this.collect("Human")}else if(a=="panTro2"||a=="gorGor1"){return this.collect("ape")}else if(a=="ponAbe2"||a=="rheMac2"||a=="papHam1"||a=="calJac1"||a=="tarSyr1"||a=="micMur1"||a=="otoGar1"){return this.collect("Monkey")}else if(a=="tupBel1"||a=="mm9"||a=="rn4"||a=="dipOrd1"||a=="cavPor3"||a=="eriEur1"||a=="sorAra1"){return this.collect("Mouse")}else if(a=="speTri1"){return this.collect("Squirell")}else if(a=="oryCun2"){return this.collect("Rabbit")}else if(a=="ochPri2"){return this.collect("Ram")}else if(a=="turTru2"){return this.collect("Dolphin")}else if(a=="bosTau4"){return this.collect("Cow")}else if(a=="equCab2"){return this.collect("Horse")}else if(a=="felCat3"){return this.collect("Cat")}else if(a=="canFam2"){return this.collect("Dog")}else if(a=="myLuc1"||a=="pteVam1"){return this.collect("bat")}else if(a=="loxAfr3"){return this.collect("Elephant")}else if(a=="proCap1"||a=="echTel1"||a=="dasNov2"||a=="ornAna1"){return this.collect("Beaver")}else if(a=="choHof1"){return this.collect("Sloth")}else if(a=="macEug"){return this.collect("Kangaroo")}else if(a=="monDom5"){return this.collect("Opossum")}else if(a=="galGal3"||a=="taeGut1"){return this.collect("bird")}else if(a=="anoCar1"){return this.collect("Lizard")}else if(a=="xenTro2"||a=="tetNig2"||a=="fr2"||a=="gasAcu1"||a=="oryLat2"||a=="danRer6"){return this.collect("Fish")}else if(a=="petMar1"){return this.collect("Eel")}else{return this.collect(a)}};a.prototype.collect=function(a){var b=new Image;var c=this;b.src="http://phylo.cs.mcgill.ca/img/"+a.toLowerCase()+".png";b.onError=function(){c.report(a)};b.className="animal";return b};a.prototype.report=function(a){console.log(a)};var b=a.prototype,c=[["get",b.get]];common.exportSingleton("images",a,c)})()
